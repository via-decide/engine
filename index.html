<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Decide Food â€“ Rajkot</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

.topbar{
  position:sticky;
  top:0;
  background:#0a0a0a;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,0.1);
  z-index:100;
}

.live-dot{
  width:10px;
  height:10px;
  background:#00e676;
  border-radius:50%;
  box-shadow:0 0 10px #00e676;
  animation:pulse 2s infinite;
}

@keyframes pulse{
  0%,100%{opacity:1}
  50%{opacity:0.5}
}

.ticker{
  font-size:0.85rem;
  color:#bbb;
  overflow:hidden;
  white-space:nowrap;
}

.container{
  padding:20px;
  max-width:600px;
  margin:auto;
}

.card{
  background:#141414;
  padding:18px;
  border-radius:16px;
  margin-bottom:16px;
  border:1px solid rgba(255,255,255,0.08);
}

button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-weight:700;
  cursor:pointer;
  margin-top:10px;
}

.primary{
  background:#ff671f;
  color:#000;
}

.secondary{
  background:#1a1a1a;
  color:#fff;
  border:1px solid rgba(255,255,255,0.2);
}

input,select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.2);
  background:#0f0f0f;
  color:#fff;
  margin-top:8px;
}

.cart-badge{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#ff671f;
  padding:14px 18px;
  border-radius:50px;
  font-weight:700;
  color:#000;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="topbar">
  <div style="display:flex;align-items:center;gap:10px">
    <div class="live-dot"></div>
    <div>Rajkot â€¢ Riders Active</div>
  </div>
  <div class="ticker" id="ticker"></div>
</div>

<div id="app" class="container"></div>
<div id="cartBadge" class="cart-badge" style="display:none"></div>

<script>
const SUPABASE_URL="YOUR_SUPABASE_URL";
const SUPABASE_KEY="YOUR_SUPABASE_ANON_KEY";
const sb = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const DELIVERY_CHARGE=25;

let STATE={
  area:null,
  urgency:null,
  preference:null,
  cart:[]
};

const RESTAURANTS=[
  {name:"Rajkot Thali House",area:"Race Course",prep:20,spicy:true},
  {name:"Kathiyawadi King",area:"Kalavad Road",prep:25,spicy:true},
  {name:"Light Bites",area:"University Road",prep:15,spicy:false}
];

function renderStep1(){
  document.getElementById("app").innerHTML=`
  <div class="card">
    <h2>Select Area</h2>
    <select id="area">
      <option>Race Course</option>
      <option>Kalavad Road</option>
      <option>University Road</option>
    </select>
    <button class="primary" onclick="step2()">Continue</button>
  </div>
  <div class="card">
    <h3>Join Decide</h3>
    <button class="secondary" onclick="window.location='mailto:dharam@viadecide.com?subject=Seller%20Onboarding'">Become Seller</button>
    <button class="secondary" onclick="window.location='mailto:dharam@viadecide.com?subject=Rider%20Application'">Become Rider</button>
  </div>
  `;
}

function step2(){
  STATE.area=document.getElementById("area").value;
  document.getElementById("app").innerHTML=`
  <div class="card">
    <h2>Urgency</h2>
    <button class="primary" onclick="setUrgency('fast')">ðŸš€ Under 30 mins</button>
    <button class="secondary" onclick="setUrgency('normal')">ðŸ•’ Normal</button>
  </div>`;
}

function setUrgency(u){
  STATE.urgency=u;
  document.getElementById("app").innerHTML=`
  <div class="card">
    <h2>Food Preference</h2>
    <button class="primary" onclick="setPref('spicy')">ðŸ”¥ Spicy</button>
    <button class="secondary" onclick="setPref('mild')">ðŸ§ˆ Mild</button>
  </div>`;
}

function setPref(p){
  STATE.preference=p;
  renderRestaurants();
}

function score(r){
  let s=0;
  if(r.area===STATE.area) s+=2;
  if(STATE.urgency==='fast' && r.prep<=20) s+=2;
  if(STATE.preference==='spicy' && r.spicy) s+=1;
  return s;
}

function renderRestaurants(){
  let filtered=RESTAURANTS.sort((a,b)=>score(b)-score(a));
  document.getElementById("app").innerHTML=
  filtered.map(r=>`
    <div class="card">
      <h3>${r.name}</h3>
      <div>Prep: ${r.prep} mins</div>
      <button class="primary" onclick="addToCart('${r.name}')">Add Thali â‚¹150</button>
    </div>
  `).join("");
}

function addToCart(name){
  STATE.cart.push({name,price:150});
  updateCart();
}

function updateCart(){
  if(STATE.cart.length){
    let total=STATE.cart.reduce((a,b)=>a+b.price,0)+DELIVERY_CHARGE;
    document.getElementById("cartBadge").style.display="block";
    document.getElementById("cartBadge").innerHTML=`Cart (${STATE.cart.length}) â€¢ â‚¹${total}`;
    document.getElementById("cartBadge").onclick=viewCart;
  }
}

function viewCart(){
  let subtotal=STATE.cart.reduce((a,b)=>a+b.price,0);
  let total=subtotal+DELIVERY_CHARGE;
  document.getElementById("app").innerHTML=`
    <div class="card">
      <h2>Your Cart</h2>
      ${STATE.cart.map(i=>`<div>${i.name} - â‚¹${i.price}</div>`).join("")}
      <hr>
      <div>Delivery: â‚¹${DELIVERY_CHARGE}</div>
      <h3>Total: â‚¹${total}</h3>
      <button class="primary" onclick="placeOrder(${total})">Place Order (Pay After Delivery)</button>
    </div>
  `;
}

async function placeOrder(total){
  const {error}=await sb.from("rajkot_orders").insert([{
    area:STATE.area,
    urgency:STATE.urgency,
    preference:STATE.preference,
    items:STATE.cart,
    total_amount:total,
    status:"pending"
  }]);
  
  if(error){
    alert("Error placing order");
    return;
  }

  alert("Order placed. We will call you to confirm.");
  STATE.cart=[];
  renderStep1();
  document.getElementById("cartBadge").style.display="none";
}

const TRUST_LINES=[
  "No commission for restaurants",
  "Flat â‚¹25 delivery",
  "Rajkot local riders",
  "Pay after delivery available"
];

let tIndex=0;
setInterval(()=>{
  document.getElementById("ticker").innerText=TRUST_LINES[tIndex%TRUST_LINES.length];
  tIndex++;
},2500);

renderStep1();
</script>

</body>
</html>
