<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Decide - India's Smart Marketplace</title>
<meta name="description" content="India's first commission-free marketplace. Compare products by YOUR priorities. Starting in Gujarat - Gandhidham & Rajkot." />
<meta name="theme-color" content="#ff671f" />

<!-- FAVICON -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />

<!-- MANIFEST -->
<link rel="manifest" href="/manifest.json" />

<!-- Razorpay SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --brand-orange:#ff671f;
  --brand-orange-light:#ff8547;
  --brand-orange-dark:#e55a0f;
  --bg-primary:#000000;
  --bg-secondary:#0a0a0a;
  --bg-card:#141414;
  --bg-card-hover:#1a1a1a;
  --border:rgba(255,255,255,0.15);
  --border-strong:rgba(255,255,255,0.2);
  --accent:#00e676;
  --accent-dark:#00c853;
  --ondc-blue:#1e88e5;
  --text-primary:#ffffff;
  --text-secondary:#b3b3b3;
  --text-tertiary:#808080;
  --error:#ff4444;
  --warning:#ffaa00;
  --success:#00e676;
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  --safe-bottom:env(safe-area-inset-bottom,0px);
  --radius-sm:12px;
  --radius-md:16px;
  --radius-lg:24px;
  --radius-xl:32px;
  --shadow-sm:0 2px 8px rgba(0,0,0,0.3);
  --shadow-md:0 4px 16px rgba(0,0,0,0.4);
  --shadow-lg:0 8px 32px rgba(0,0,0,0.5);
  --shadow-xl:0 16px 48px rgba(0,0,0,0.6);
}

*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{min-height:100%;background:var(--bg-primary);color:var(--text-primary);font-family:var(--font);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{background:linear-gradient(180deg,#000 0%,#0a0a0a 100%)}
button,input,textarea,select{font:inherit;border:none;background:none;outline:none}
button{cursor:pointer;transition:all 0.2s ease}
a{text-decoration:none;color:inherit}
img{max-width:100%;display:block}

/* SCROLLBAR */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:var(--bg-secondary)}
::-webkit-scrollbar-thumb{background:var(--border-strong);border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:var(--text-tertiary)}

/* APP CONTAINER */
#app{min-height:100vh;padding:20px;padding-bottom:calc(80px + var(--safe-bottom))}

/* DEMO LABELS */
.demo-ribbon{
  position:fixed;top:18px;right:-52px;
  background:#ff3b3b;color:#fff;
  padding:10px 78px;
  font-weight:900;font-size:12px;letter-spacing:2px;text-transform:uppercase;
  transform:rotate(45deg);
  z-index:9999;
  box-shadow:0 10px 25px rgba(0,0,0,.35);
  display:none;
}
.demo-pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(255,59,59,.45);
  background:rgba(255,59,59,.12);
  color:#ff6b6b;font-weight:900;letter-spacing:1px;font-size:.75rem;text-transform:uppercase;
}
.demo-note{
  background:rgba(255,255,255,0.04);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px 16px;
  margin:0 0 16px;
  color:#bbb;
  line-height:1.65;
}
.demo-note b{color:#fff}

/* HEADER */
.header{
  position:sticky;top:0;z-index:100;
  background:rgba(10,10,10,0.95);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  padding:16px 20px;
  display:flex;align-items:center;justify-content:space-between;gap:16px;
  margin:-20px -20px 20px;
}
.header-badge{
  background:rgba(255,103,31,0.1);
  border:2px solid var(--brand-orange);
  padding:12px 18px;border-radius:12px;
  font-size:.85rem;font-weight:800;letter-spacing:1px;
  color:var(--brand-orange);
  display:flex;align-items:center;gap:10px;flex:1;
}
.status-dot{
  width:10px;height:10px;background:var(--accent);border-radius:50%;
  box-shadow:0 0 10px var(--accent);animation:pulse 2s infinite;display:inline-block;
}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

.btn{
  background:transparent;border:2px solid rgba(255,255,255,0.3);
  padding:10px 18px;border-radius:50px;font-size:.85rem;
  font-weight:800;color:#fff;transition:.2s;
}
.btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.5)}
.btn:focus-visible{outline:3px solid rgba(255,103,31,.75);outline-offset:3px}

/* FLOATING CART */
.floating-cart{
  position:fixed;bottom:24px;right:24px;z-index:1000;
  background:var(--brand-orange);color:var(--bg-primary);
  padding:14px 24px;border-radius:999px;
  box-shadow:0 12px 40px rgba(255,103,31,0.4),0 0 0 1px rgba(255,103,31,0.2);
  font-weight:700;font-size:0.875rem;
  display:flex;align-items:center;gap:10px;
  transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
}
.floating-cart:hover{
  transform:translateY(-4px) scale(1.05);
  box-shadow:0 16px 48px rgba(255,103,31,0.5);
}
.floating-cart:active{transform:translateY(-2px) scale(1.02)}
.cart-badge{
  background:var(--bg-primary);color:var(--brand-orange);
  width:24px;height:24px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:0.75rem;font-weight:900;
}

/* LAYOUT */
.wrap{max-width:760px;margin:0 auto;width:100%}
.two-col-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:18px}
.left-col,.right-col{display:flex;flex-direction:column;gap:14px}
.col-header{
  text-align:center;font-size:.72rem;font-weight:900;letter-spacing:1.5px;
  color:#888;padding:10px 0;border-bottom:1px solid var(--border);margin-bottom:4px;
}

/* CARDS */
.card{
  background:rgba(20,20,20,0.6);border:1px solid var(--border);
  border-radius:22px;padding:20px 16px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:10px;cursor:pointer;transition:.2s;min-height:120px;
}
.card:hover{
  background:rgba(40,40,40,0.8);border-color:rgba(255,255,255,0.3);
  transform:translateY(-3px);
}
.card[aria-disabled="true"]{opacity:.35;cursor:not-allowed;pointer-events:none}
.card:focus-visible{outline:3px solid rgba(255,103,31,.75);outline-offset:3px}

.icon{font-size:2.6rem}
.title{font-size:1rem;font-weight:900;letter-spacing:.5px;text-align:center;margin:0;line-height:1.2}
.tag{
  font-size:.7rem;font-weight:800;letter-spacing:1.2px;
  padding:4px 10px;border-radius:8px;text-align:center;
}
.tag-live{color:var(--accent);background:rgba(0,230,118,0.15)}
.tag-neutral{color:#888;background:rgba(136,136,136,0.15)}
.tag-soon{color:#FFA726;background:rgba(255,167,38,0.15)}
.tag-beta{color:#4CAF50;background:rgba(76,175,80,0.15)}
.tag-city{color:#42A5F5;background:rgba(66,165,245,0.15)}

/* HERO SECTION */
.hero{
  text-align:center;padding:48px 20px 32px;
  background:linear-gradient(135deg,rgba(255,103,31,0.08),transparent);
  border-radius:var(--radius-xl);margin-bottom:32px;
}
.hero-title{
  font-size:2.5rem;font-weight:900;margin-bottom:12px;
  background:linear-gradient(135deg,var(--text-primary),var(--text-secondary));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  letter-spacing:-1px;line-height:1.1;
}
.hero-subtitle{
  font-size:1.125rem;color:var(--text-secondary);line-height:1.6;
  max-width:600px;margin:0 auto;
}

/* RESTAURANT GRID */
.restaurant-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:24px;margin-bottom:32px;
}

/* RESTAURANT CARD */
.restaurant-card{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  overflow:hidden;
  transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
  cursor:pointer;
  position:relative;
}
.restaurant-card:hover{
  background:var(--bg-card-hover);
  border-color:var(--border-strong);
  transform:translateY(-4px);
  box-shadow:var(--shadow-lg);
}
.restaurant-card:active{transform:translateY(-2px)}

.restaurant-image{
  width:100%;height:180px;
  background:linear-gradient(135deg,rgba(255,103,31,0.2),rgba(255,103,31,0.05));
  display:flex;align-items:center;justify-content:center;
  font-size:4rem;position:relative;overflow:hidden;
}
.restaurant-image::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(circle at 30% 30%,rgba(255,103,31,0.3),transparent);
}

.restaurant-info{padding:20px}
.restaurant-header{margin-bottom:12px}
.restaurant-name{
  font-size:1.25rem;font-weight:700;margin-bottom:6px;
  line-height:1.3;
}
.restaurant-meta{
  display:flex;align-items:center;gap:12px;flex-wrap:wrap;
  font-size:0.875rem;color:var(--text-secondary);
}
.meta-item{display:flex;align-items:center;gap:4px}
.rating{
  background:var(--success);color:var(--bg-primary);
  padding:2px 8px;border-radius:6px;
  font-weight:700;font-size:0.8125rem;
}
.restaurant-tags{
  display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;
}
.tag.veg{
  background:rgba(0,230,118,0.1);
  border-color:rgba(0,230,118,0.3);
  color:var(--success);
}
.restaurant-footer{
  padding-top:12px;border-top:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.price-hint{
  font-size:0.875rem;color:var(--text-secondary);
}
.price-amount{
  font-weight:700;color:var(--text-primary);
}
.view-menu-btn{
  padding:8px 20px;border-radius:999px;
  background:var(--brand-orange);color:var(--bg-primary);
  font-weight:700;font-size:0.875rem;
  transition:all 0.2s ease;
}
.view-menu-btn:hover{
  background:var(--brand-orange-light);
  transform:scale(1.05);
}

/* MENU VIEW */
.menu-header{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:24px;margin-bottom:24px;
}
.menu-restaurant-name{font-size:2rem;font-weight:900;margin-bottom:8px}
.menu-restaurant-meta{
  display:flex;align-items:center;gap:16px;flex-wrap:wrap;
  color:var(--text-secondary);font-size:0.875rem;
}

/* MENU CATEGORIES */
.menu-categories{
  display:flex;gap:12px;overflow-x:auto;
  padding:8px 0 16px;margin-bottom:24px;
  scrollbar-width:none;
}
.menu-categories::-webkit-scrollbar{display:none}
.category-btn{
  padding:10px 24px;border-radius:999px;
  background:var(--bg-card);
  border:1px solid var(--border);
  color:var(--text-secondary);
  font-weight:600;font-size:0.875rem;
  white-space:nowrap;flex-shrink:0;
  transition:all 0.2s ease;
}
.category-btn:hover{
  background:var(--bg-card-hover);
  border-color:var(--border-strong);
}
.category-btn.active{
  background:var(--brand-orange);
  border-color:var(--brand-orange);
  color:var(--bg-primary);
}

/* MENU GRID */
.menu-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:20px;margin-bottom:32px;
}

/* MENU ITEM CARD */
.menu-item{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-md);
  padding:16px;
  transition:all 0.2s ease;
  display:flex;flex-direction:column;
}
.menu-item:hover{
  background:var(--bg-card-hover);
  border-color:var(--border-strong);
  transform:translateY(-2px);
  box-shadow:var(--shadow-md);
}
.menu-item-header{
  display:flex;justify-content:space-between;align-items:start;
  margin-bottom:8px;
}
.menu-item-info{flex:1}
.menu-item-icon{
  font-size:2.5rem;
  width:60px;height:60px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,103,31,0.1);
  border-radius:var(--radius-sm);
}
.menu-item-name{
  font-size:1.125rem;font-weight:700;margin-bottom:4px;
  line-height:1.3;
}
.menu-item-desc{
  font-size:0.875rem;color:var(--text-secondary);
  margin-bottom:8px;line-height:1.5;
}
.menu-item-meta{
  display:flex;align-items:center;gap:12px;
  font-size:0.8125rem;color:var(--text-tertiary);
  margin-bottom:12px;
}
.menu-item-footer{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:auto;padding-top:12px;
  border-top:1px solid var(--border);
}
.menu-item-price{
  font-size:1.25rem;font-weight:900;
  color:var(--text-primary);
}
.add-to-cart-btn{
  padding:8px 20px;border-radius:999px;
  background:var(--brand-orange);color:var(--bg-primary);
  font-weight:700;font-size:0.875rem;
  display:flex;align-items:center;gap:6px;
  transition:all 0.2s ease;
}
.add-to-cart-btn:hover{
  background:var(--brand-orange-light);
  transform:scale(1.05);
}
.add-to-cart-btn:active{transform:scale(0.98)}

/* CART VIEW */
.cart-container{max-width:800px;margin:0 auto}
.cart-items{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:24px;margin-bottom:24px;
}
.cart-title{font-size:1.5rem;font-weight:900;margin-bottom:20px}
.cart-item{
  display:flex;align-items:center;gap:16px;
  padding:16px;border-radius:var(--radius-md);
  background:rgba(255,255,255,0.03);
  margin-bottom:12px;
}
.cart-item:last-child{margin-bottom:0}
.cart-item-info{flex:1}
.cart-item-name{font-weight:700;margin-bottom:4px}
.cart-item-seller{font-size:0.875rem;color:var(--text-secondary)}
.cart-item-price{font-weight:900;color:var(--brand-orange)}
.remove-btn{
  padding:6px 12px;border-radius:8px;
  background:rgba(255,68,68,0.1);
  border:1px solid rgba(255,68,68,0.3);
  color:var(--error);font-size:0.8125rem;font-weight:600;
}
.remove-btn:hover{background:rgba(255,68,68,0.2)}

/* CART SUMMARY */
.cart-summary{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:24px;margin-bottom:24px;
}
.summary-row{
  display:flex;justify-content:space-between;
  padding:12px 0;font-size:0.9375rem;
}
.summary-row.total{
  padding-top:16px;border-top:1px solid var(--border);
  font-size:1.25rem;font-weight:900;
  color:var(--brand-orange);
}
.summary-label{color:var(--text-secondary)}
.summary-value{font-weight:700}

/* PAYMENT SECTION */
.payment-section{
  background:var(--bg-card);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:24px;margin-bottom:24px;
}
.payment-title{font-size:1.25rem;font-weight:900;margin-bottom:20px}
.payment-methods{display:flex;flex-direction:column;gap:12px}
.payment-method{
  padding:20px;border-radius:var(--radius-md);
  background:rgba(255,255,255,0.03);
  border:2px solid var(--border);
  display:flex;align-items:center;gap:16px;
  transition:all 0.2s ease;cursor:pointer;
}
.payment-method:hover{
  background:rgba(255,255,255,0.05);
  border-color:var(--border-strong);
}
.payment-method.selected{
  border-color:var(--brand-orange);
  background:rgba(255,103,31,0.08);
}
.payment-icon{
  font-size:2rem;
  width:48px;height:48px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,103,31,0.1);
  border-radius:var(--radius-sm);
}
.payment-info{flex:1}
.payment-name{font-weight:700;margin-bottom:4px}
.payment-desc{font-size:0.875rem;color:var(--text-secondary)}
.payment-badge{
  padding:4px 12px;border-radius:999px;
  background:var(--success);color:var(--bg-primary);
  font-size:0.75rem;font-weight:700;
}

/* BUTTONS */
.action,.secondary{
  padding:16px 32px;border-radius:var(--radius-md);
  font-weight:700;font-size:1rem;
  display:flex;align-items:center;justify-content:center;gap:8px;
  transition:all 0.2s ease;width:100%;
  text-transform:uppercase;
}
.action{
  background:var(--brand-orange);color:var(--bg-primary);
}
.action:hover{
  background:var(--brand-orange-light);
  transform:translateY(-2px);
  box-shadow:var(--shadow-md);
}
.action:active{transform:translateY(0)}
.secondary{
  background:transparent;color:#fff;
  border:2px solid var(--border);
}
.secondary:hover{
  background:rgba(255,255,255,0.1);
  border-color:var(--border-strong);
}

/* SUCCESS SCREEN */
.success-screen{
  text-align:center;padding:48px 20px;
}
.success-icon{
  width:100px;height:100px;border-radius:50%;
  background:var(--success);
  display:flex;align-items:center;justify-content:center;
  margin:0 auto 24px;
  font-size:3rem;
  animation:successPop 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);
}
@keyframes successPop{
  0%{transform:scale(0) rotate(-45deg);opacity:0}
  50%{transform:scale(1.2) rotate(0deg)}
  100%{transform:scale(1) rotate(0deg);opacity:1}
}
.success-title{
  font-size:2rem;font-weight:900;margin-bottom:12px;
  color:var(--success);
}
.success-order-id{
  display:inline-flex;align-items:center;gap:8px;
  padding:12px 24px;border-radius:999px;
  background:rgba(0,230,118,0.1);
  border:1px solid rgba(0,230,118,0.3);
  font-weight:700;margin-bottom:32px;
}

/* TOAST */
.toast{
  position:fixed;bottom:calc(24px + var(--safe-bottom));left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--bg-card);
  border:1px solid var(--border-strong);
  padding:16px 24px;border-radius:var(--radius-md);
  box-shadow:var(--shadow-xl);
  font-weight:600;font-size:0.9375rem;
  z-index:2000;opacity:0;
  transition:all 0.3s cubic-bezier(0.68,-0.55,0.265,1.55);
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}
.toast.success{border-color:var(--success);color:var(--success)}
.toast.error{border-color:var(--error);color:var(--error)}

/* RESULTS */
.results{max-width:860px;margin:0 auto;padding:8px 0}
.result{
  background:rgba(20,20,20,0.6);border:1px solid var(--border);
  border-radius:18px;padding:18px;margin-bottom:12px;transition:.2s;
}
.result:hover{background:rgba(30,30,30,0.8);border-color:rgba(255,255,255,0.3)}
.row{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.name{font-size:1.12rem;font-weight:900;margin:0 0 6px}
.seller{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.badge{
  background:rgba(30,136,229,0.2);color:var(--ondc-blue);
  padding:4px 10px;border-radius:8px;font-size:.75rem;font-weight:800;
}
.price{text-align:right}
.price-main{font-size:1.6rem;font-weight:900;color:var(--brand-orange)}

/* FILTERS */
.filter-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px}
.filter-btn{
  background:rgba(20,20,20,0.6);border:2px solid var(--border);
  padding:18px;border-radius:16px;text-align:center;font-weight:900;font-size:1rem;
  cursor:pointer;transition:.2s;text-transform:uppercase;
}
.filter-btn:hover{background:rgba(40,40,40,0.8);border-color:rgba(255,255,255,0.3)}
.filter-btn.active{background:var(--brand-orange);color:#000;border-color:var(--brand-orange)}

/* INPUTS */
input,textarea{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.05);
  color:#fff;
  outline:none;
}
textarea{min-height:120px;resize:vertical}
input:focus,textarea:focus{border-color:var(--brand-orange)}

.label{color:#888;font-size:.85rem;margin-bottom:8px}
.value{font-weight:800;font-size:.9rem}

/* PAYMENT BOX */
.payment-box{
  background:rgba(255,255,255,0.03);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  margin-bottom:14px;
}

.kbd{
  display:inline-flex;align-items:center;justify-content:center;
  padding:6px 10px;border-radius:10px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(255,255,255,0.03);
  font-weight:900;font-size:.85rem;
}

/* FOOTER */
.footer{
  text-align:center;margin-top:30px;padding-top:20px;
  border-top:1px solid var(--border);color:#666;font-size:.85rem;
}
.footer a{color:#888;margin:0 10px;text-decoration:none}
.footer a:hover{color:var(--brand-orange)}

/* INFO BOX */
.info-box{
  background:rgba(66,165,245,0.1);
  border:1px solid rgba(66,165,245,0.3);
  border-radius:12px;
  padding:12px 16px;
  margin:16px 0;
  color:#90CAF9;
  font-size:0.875rem;
  line-height:1.6;
}

/* STATIC PAGES */
.static-page{max-width:860px;margin:0 auto}
.static-hero{
  background:linear-gradient(135deg,rgba(255,103,31,0.10),transparent);
  border:1px solid var(--border);
  border-radius:32px;
  padding:26px 20px;
  box-shadow:var(--shadow-lg);
  margin-bottom:16px;
}
.static-meta{color:var(--text-secondary);font-size:.95rem;line-height:1.6}
.static-card{
  background:rgba(20,20,20,0.65);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:18px;
  margin:12px 0;
}
.static-card h2{font-size:1.15rem;margin:0 0 10px}
.static-card p,.static-card li{color:var(--text-secondary);line-height:1.75}
.static-card ul{padding-left:18px}
.kv{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.pill{
  border:1px solid var(--border-strong);
  background:rgba(255,255,255,0.04);
  padding:8px 12px;border-radius:999px;
  color:#ddd;font-weight:700;font-size:.85rem;
}
.pill strong{color:var(--brand-orange)}
.item{
  border:1px solid var(--border-strong);
  background:rgba(255,255,255,0.04);
  padding:14px;border-radius:16px;
}
.item .label{color:var(--text-tertiary);font-weight:800;font-size:.85rem;letter-spacing:.6px;text-transform:uppercase;margin-bottom:6px}
.item .value{font-weight:900}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}

/* RESPONSIVE */
@media (max-width:768px){
  .hero-title{font-size:2rem}
  .restaurant-grid{grid-template-columns:1fr}
  .menu-grid{grid-template-columns:1fr}
  .menu-restaurant-name{font-size:1.5rem}
  .floating-cart{
    bottom:16px;right:16px;
    padding:12px 20px;font-size:0.8125rem;
  }
  .two-col-grid{grid-template-columns:1fr}
}
@media (max-width:480px){
  #app{padding:16px}
  .hero{padding:32px 16px 24px}
  .hero-title{font-size:1.75rem}
  .restaurant-info{padding:16px}
}
</style>
</head>
<body>

<div id="app"></div>
<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
<div id="floatingCart" class="floating-cart" style="display:none">
  <span class="cart-badge" id="cartCount">0</span>
  <span>View Cart</span>
</div>

<script>
(function(){
  "use strict";
  
  const RAZORPAY_KEY = "rzp_test_YOUR_KEY_ID";
  const SUPABASE_URL = "https://zdarsygrpqbbcafrqcjt.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkYXJzeWdycHFiYmNhZnJxY2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODczMTUsImV4cCI6MjA4NjU2MzMxNX0.ut97BRi9_UFkeZuG_6Ue4mXdAAmtH6MFFdi2vUgHiW4";
  
  let sbClient = null;
  
  function initSupabase(){
    try{
      if(typeof window.supabase !== 'undefined' && window.supabase.createClient){
        sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('‚úÖ Supabase initialized');
        return sbClient;
      }
    }catch(e){
      console.error('Supabase init error:', e);
    }
    return null;
  }
  
  const STATE = {
    cart: [],
    orders: [],
    currentRestaurant: null,
    selectedPaymentMethod: 'razorpay',
    filterCategory: 'all',
    domain: null,
    session: "SID-" + Math.random().toString(36).slice(2,6).toUpperCase(),
    filters: [],
    lastEcomCategory: null,
    lastPaymentAmount: null,
    lastTxnRef: null
  };
  
  var DEVICE_ID = localStorage.getItem("decide_device_id");
  if(!DEVICE_ID){ DEVICE_ID = safeId(); localStorage.setItem("decide_device_id", DEVICE_ID); }
  
  const RESTAURANTS = [
    {
      id: "rajkot-thali-001",
      name: "Unlimited Gujarati Thali",
      type: "Gujarati",
      area: "Race Course Road",
      rating: 4.8,
      prepTime: 25,
      priceForTwo: 300,
      tags: ["veg", "family", "unlimited"],
      icon: "üçõ",
      upiId: "6351537770@yapl",
      upiAccountName: "Dharam Jitendra Daxini",
      whatsapp: "https://wa.me/916351537770",
      menu: [
        {id:"thali-1",name:"Gujarati Thali",price:150,veg:true,desc:"Unlimited traditional thali with 4 sabzis, dal, rice, roti, papad, pickle, buttermilk",prepMins:20,category:"main",icon:"üçõ"},
        {id:"pav-1",name:"Pav Bhaji",price:120,veg:true,desc:"Mumbai style pav bhaji with butter and lemon",prepMins:15,category:"main",icon:"ü•ò"},
        {id:"dhokla-1",name:"Khaman Dhokla",price:60,veg:true,desc:"Soft and fluffy steamed dhokla",prepMins:10,category:"snacks",icon:"üü°"},
        {id:"chaas-1",name:"Masala Chaas",price:25,veg:true,desc:"Fresh buttermilk with spices",prepMins:5,category:"drinks",icon:"ü•§"},
        {id:"fafda-1",name:"Fafda Jalebi",price:80,veg:true,desc:"Crispy fafda with sweet jalebi",prepMins:15,category:"snacks",icon:"ü•®"}
      ]
    }
  ];
  
  var ECOMMERCE_DATA = [
    {category:"smartphones",name:"iPhone 15 Pro",price:134900,cam:9,gam:9,bat:7,seller:"Apple Store",rating:4.8,stock:50,delivery:"2 days",warranty:"1 year",city:"Gandhidham"},
    {category:"smartphones",name:"Samsung S24 Ultra",price:129999,cam:10,gam:9,bat:8,seller:"Samsung",rating:4.9,stock:40,delivery:"3 days",warranty:"1 year",city:"Gandhidham"},
    {category:"smartphones",name:"OnePlus 12",price:63999,cam:8,gam:9,bat:9,seller:"OnePlus",rating:4.7,stock:110,delivery:"1 day",warranty:"1 year",city:"Gandhidham"},
    {category:"earbuds",name:"AirPods Pro 2",price:24499,snd:9,anc:10,mic:9,seller:"Apple Store",rating:4.8,stock:150,delivery:"1 day",warranty:"1 year",city:"Gandhidham"},
    {category:"earbuds",name:"Sony WF-1000XM5",price:23990,snd:10,anc:10,mic:8,seller:"Sony",rating:4.8,stock:90,delivery:"1 day",warranty:"1 year",city:"Gandhidham"},
    {category:"laptops",name:"MacBook Air M3",price:113900,perf:9,port:7,scr:9,seller:"Apple Store",rating:4.8,stock:55,delivery:"2 days",warranty:"1 year",city:"Gandhidham"},
    {category:"laptops",name:"Dell XPS 13",price:139990,perf:8,port:6,scr:9,seller:"Dell",rating:4.7,stock:40,delivery:"4 days",warranty:"1 year",city:"Gandhidham"}
  ];
  
  var DB = { smartphones:{}, earbuds:{}, laptops:{} };
  var RESULTS = [];
  
  function $(id){return document.getElementById(id)}
  function esc(s){
    s = String(s == null ? "" : s);
    return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");
  }
  function money(n){return "‚Çπ" + Number(n||0).toLocaleString("en-IN")}
  
  function calcCartTotals(){
    const subtotal = STATE.cart.reduce((sum, item) => {
      const price = Number(item.price || 0);
      const qty = Number(item.qty || 1);
      return sum + (price * qty);
    }, 0);
    const isFood = (STATE.cart[0] && STATE.cart[0].type === "food");
    const taxRate = isFood ? 0.05 : 0.18;
    const gst = Math.round(subtotal * taxRate);
    const total = Number((subtotal + gst).toFixed(2));
    return { subtotal, gst, total, isFood, taxRate };
  }
  
  function safeId(){
    try{ if(window.crypto && crypto.randomUUID) return crypto.randomUUID(); }catch(e){}
    return "dev-" + Math.random().toString(36).slice(2) + "-" + Date.now().toString(36);
  }
  
  function toast(msg, type = 'success'){
    const t = $("toast");
    if(!t) return;
    t.textContent = String(msg);
    t.className = 'toast ' + type;
    t.classList.add("show");
    clearTimeout(toast._t);
    toast._t = setTimeout(() => t.classList.remove("show"), 3000);
  }
  
  function updateFloatingCart(){
    const fc = $("floatingCart");
    const count = STATE.cart.length;
    if(count > 0){
      fc.style.display = 'flex';
      $("cartCount").textContent = count;
    }else{
      fc.style.display = 'none';
    }
  }
  
  function saveCart(){
    try{ localStorage.setItem('decide_cart', JSON.stringify(STATE.cart)); }catch(e){}
  }
  
  function loadCart(){
    try{
      const data = JSON.parse(localStorage.getItem('decide_cart') || '[]');
      STATE.cart = Array.isArray(data) ? data : [];
    }catch(e){ STATE.cart = []; }
  }
  
  function loadOrders(){
    try{
      var x = JSON.parse(localStorage.getItem("order_history") || "[]");
      STATE.orders = Array.isArray(x) ? x : [];
    }catch(e){ STATE.orders = []; }
  }
  
  function saveOrders(){
    try{ localStorage.setItem("order_history", JSON.stringify(STATE.orders)); }catch(e){}
  }
  
  function loadToMemory(arr){
    DB = { smartphones:{}, earbuds:{}, laptops:{} };
    (arr || []).forEach(function(p){
      if(!p || !p.category || !p.name) return;
      if(!DB[p.category]) DB[p.category] = {};
      if(!DB[p.category][p.name]) DB[p.category][p.name] = [];
      DB[p.category][p.name].push({
        name:p.name,
        price:Number(p.price)||0,
        seller:p.seller||"Seller",
        rating:Number(p.rating)||4.0,
        stock:Number(p.stock)||0,
        delivery:p.delivery||"2-5 days",
        warranty:p.warranty||"6 months",
        city:p.city||"",
        attr:{
          cam:Number(p.cam)||0, gam:Number(p.gam)||0, bat:Number(p.bat)||0,
          snd:Number(p.snd)||0, anc:Number(p.anc)||0, mic:Number(p.mic)||0,
          perf:Number(p.perf)||0, port:Number(p.port)||0, scr:Number(p.scr)||0
        }
      });
    });
  }
  
  function loadUtrIndex(){
    try{
      var x = JSON.parse(localStorage.getItem("utr_index") || "{}");
      return (x && typeof x === "object") ? x : {};
    }catch(e){ return {}; }
  }
  
  function saveUtrIndex(idx){
    try{ localStorage.setItem("utr_index", JSON.stringify(idx || {})); }catch(e){}
  }
  
  async function apiPost(fnName, payload){
    const url = SUPABASE_URL.replace(/\/+$/,"") + "/functions/v1/" + encodeURIComponent(fnName);
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": SUPABASE_ANON_KEY,
        "Authorization": "Bearer " + SUPABASE_ANON_KEY
      },
      body: JSON.stringify(payload || {})
    });
    const text = await res.text();
    let data = null;
    try{ data = text ? JSON.parse(text) : null; }catch(e){ data = { raw: text }; }
    if(!res.ok){
      const msg = (data && (data.error || data.message)) ? (data.error || data.message) : ("Request failed ("+res.status+")");
      throw new Error(msg);
    }
    return data;
  }
  
  function saveFeedbackLocal(title, message){
    try{
      var arr = JSON.parse(localStorage.getItem("feedback_items") || "[]");
      if(!Array.isArray(arr)) arr = [];
      arr.push({ id:safeId(), title:title||"Feedback", message:message, ts:new Date().toISOString(), device:DEVICE_ID });
      localStorage.setItem("feedback_items", JSON.stringify(arr));
    }catch(e){}
  }
  
  async function submitFeedback(title, message){
    try{
      await apiPost("feedback", { title:title||"Feedback", message:message, device_id: DEVICE_ID });
      toast("‚úÖ Feedback saved!");
      return true;
    }catch(err){
      console.warn("feedback fn failed, local fallback:", err);
      saveFeedbackLocal(title, message);
      toast("Saved locally");
      return true;
    }
  }
  
  function saveSellerInterestLocal(type, businessName, city, phone, idea){
    try{
      var arr = JSON.parse(localStorage.getItem("seller_interest") || "[]");
      if(!Array.isArray(arr)) arr = [];
      arr.push({ id:safeId(), type:type, businessName:businessName, city:city, phone:phone, idea:idea, device:DEVICE_ID, ts:new Date().toISOString() });
      localStorage.setItem("seller_interest", JSON.stringify(arr));
    }catch(e){}
  }
  
  async function submitSellerInterest(type, businessName, city, phone, idea){
    try{
      await apiPost("seller-interest", {
        category:type, business_name:businessName, city:city, phone:phone, idea:idea||null, device_id:DEVICE_ID
      });
      toast("‚úÖ Submitted!");
      return true;
    }catch(err){
      console.warn("seller-interest fn failed, local fallback:", err);
      saveSellerInterestLocal(type, businessName, city, phone, idea);
      toast("Submitted (local)");
      return true;
    }
  }
  
  function saveWaitlistLocal(email, phone, city, interest){
    try{
      var arr = JSON.parse(localStorage.getItem("waitlist_local") || "[]");
      if(!Array.isArray(arr)) arr = [];
      arr.push({ id:safeId(), email:email, phone:phone||"", city:city||"", interest:interest||"", device:DEVICE_ID, ts:new Date().toISOString() });
      localStorage.setItem("waitlist_local", JSON.stringify(arr));
    }catch(e){}
  }
  
  async function joinWaitlist(email, phone, city, interest){
    try{
      const out = await apiPost("waitlist", {
        email: email,
        phone: phone || null,
        city: city || null,
        interest: interest || null,
        source: "website",
        device_id: DEVICE_ID
      });
      if(out && out.already){
        toast("Already registered!");
        return false;
      }
      toast("‚úÖ Added to waitlist!");
      return true;
    }catch(err){
      console.warn("waitlist fn failed, local fallback:", err);
      saveWaitlistLocal(email, phone, city, interest);
      toast("Saved locally");
      return true;
    }
  }
  
  function isVisited(){ return localStorage.getItem("decide_visited") === "true"; }
  function markVisited(){ localStorage.setItem("decide_visited","true"); }
  
  function renderLanding(){
    $("app").innerHTML =
      '<div class="wrap" style="text-align:center;padding-top:26px">' +
        '<div class="header" style="margin-bottom:10px">' +
          '<div class="header-badge">DECIDE INDIA <span class="status-dot" aria-hidden="true"></span></div>' +
          '<button class="btn" type="button" data-action="home">HOME</button>' +
        '</div>' +
        '<div class="demo-note">‚ö† <b>Beta Version</b> ‚Äî Currently serving Rajkot. More cities coming soon!</div>' +
        '<h1 style="font-size:3rem;margin:10px 0 10px;color:var(--brand-orange);letter-spacing:2px">DECIDE</h1>' +
        '<div class="p" style="font-size:1.05rem;margin-bottom:18px;color:#bbb">India\'s Smart Marketplace (Commission-free)</div>' +
        '<div class="payment-box" style="max-width:760px;margin:0 auto 14px;text-align:left">' +
          '<div style="font-size:1.05rem;font-weight:900;margin-bottom:10px">üéØ What is Decide?</div>' +
          '<div style="color:#ccc;line-height:1.7">' +
            '‚Ä¢ <b>Smart comparison:</b> Compare products by YOUR priorities<br>' +
            '‚Ä¢ <b>Zero commission:</b> No seller commission / no paid rank<br>' +
            '‚Ä¢ <b>Local-first:</b> City-first discovery (starting Gujarat)<br>' +
            '‚Ä¢ <b>Transparent ranking:</b> No algorithm suppression' +
          '</div>' +
        '</div>' +
        '<div class="payment-box" style="max-width:760px;margin:0 auto 14px;text-align:left">' +
          '<div style="font-size:1.05rem;font-weight:900;margin-bottom:10px">üöÄ What\'s Live Now?</div>' +
          '<div style="color:#ccc;line-height:1.7">' +
            '‚úÖ <b>Gandhidham:</b> E-commerce (phones, laptops, audio)<br>' +
            '‚úÖ <b>Rajkot:</b> Food (UPI payment with Razorpay & manual UPI)<br>' +
            '‚è≥ <b>Next:</b> Ahmedabad ‚Üí Surat ‚Üí All India' +
          '</div>' +
        '</div>' +
        '<div class="payment-box" style="max-width:760px;margin:0 auto 18px;text-align:left">' +
          '<div style="font-size:1.05rem;font-weight:900;margin-bottom:10px">üìß Join Waitlist</div>' +
          '<div class="label">Email</div>' +
          '<input id="wl_email" type="email" placeholder="you@gmail.com" style="margin:8px 0 10px" />' +
          '<div class="label">City (optional)</div>' +
          '<input id="wl_city" placeholder="e.g. Rajkot" style="margin:8px 0 10px" />' +
          '<div class="label">I am (optional)</div>' +
          '<input id="wl_interest" placeholder="buyer / seller / developer" style="margin:8px 0 12px" />' +
          '<button class="action" type="button" data-action="waitlistSubmit">GET EARLY ACCESS</button>' +
          '<div style="color:#777;font-size:.85rem;margin-top:10px;line-height:1.6">We store only minimal info. You can request removal anytime.</div>' +
        '</div>' +
        '<button class="secondary" type="button" data-action="lobby">SKIP TO APP ‚Üí</button>' +
        '<div class="footer">' +
          '<a data-action="privacy">Privacy</a> ‚Ä¢ ' +
          '<a data-action="terms">Terms</a> ‚Ä¢ ' +
          '<a data-action="contact">Contact</a>' +
        '</div>' +
      '</div>';
  }
  
  function submitWaitlist(){
    var email = (($("wl_email")||{}).value || "").trim();
    var city = (($("wl_city")||{}).value || "").trim();
    var interest = (($("wl_interest")||{}).value || "").trim();
    if(!email || email.indexOf("@") < 1){ toast("Enter valid email"); return; }
    joinWaitlist(email, null, city, interest || "landing").then(function(ok){
      if(ok){ markVisited(); setTimeout(function(){ renderLobby(); }, 500); }
    });
  }
  
  function renderLobby(){
    var cartCount = STATE.cart.length;
    $("app").innerHTML =
      '<div class="header">' +
        '<div class="header-badge">DECIDE INDIA <span class="status-dot" aria-hidden="true"></span></div>' +
        '<button class="btn" type="button" data-action="home">HOME</button>' +
      '</div>' +
      '<div class="demo-note">üéâ <b>Now Live in Rajkot!</b> Order food with Razorpay or UPI payment.</div>' +
      '<div class="two-col-grid">' +
        '<div class="left-col">' +
          '<div class="col-header">MAIN CATEGORIES</div>' +
          '<div class="card" role="button" tabindex="0" data-action="seller">' +
            '<div class="icon">üè™</div><div class="title">BECOME A SELLER</div>' +
            '<div class="tag" style="background:var(--brand-orange);color:#000">START</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" data-action="module" data-module="ecommerce">' +
            '<div class="icon">üõçÔ∏è</div><div class="title">E-COMMERCE</div><div class="tag tag-live">GANDHIDHAM</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" data-action="module" data-module="food">' +
            '<div class="icon">üçΩÔ∏è</div><div class="title">FOOD</div><div class="tag tag-live">RAJKOT ‚Ä¢ UPI</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üëï</div><div class="title">FASHION</div><div class="tag tag-soon">DISABLED</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üõí</div><div class="title">GROCERIES</div><div class="tag tag-soon">DISABLED</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üï∂Ô∏è</div><div class="title">ACCESSORIES</div><div class="tag tag-soon">DISABLED</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" data-action="feedback">' +
            '<div class="icon">üí¨</div><div class="title">FEEDBACK CENTER</div><div class="tag tag-beta">OPEN</div>' +
          '</div>' +
        '</div>' +
        '<div class="right-col">' +
          '<div class="col-header">ACTIVE MVP CITIES</div>' +
          '<div class="card" role="button" tabindex="0" data-action="city" data-city="Gandhidham">' +
            '<div class="icon">üèôÔ∏è</div><div class="title">GANDHIDHAM</div><div class="tag tag-city">E-COM LIVE</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" data-action="city" data-city="Rajkot">' +
            '<div class="icon">üèôÔ∏è</div><div class="title">RAJKOT</div><div class="tag tag-city">FOOD LIVE</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üèôÔ∏è</div><div class="title">AHMEDABAD</div><div class="tag tag-soon">SOON</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üèôÔ∏è</div><div class="title">SURAT</div><div class="tag tag-soon">SOON</div>' +
          '</div>' +
          '<div class="card" role="button" tabindex="0" aria-disabled="true">' +
            '<div class="icon">üáÆüá≥</div><div class="title">ALL INDIA</div><div class="tag tag-soon">PHASE 2</div>' +
          '</div>' +
        '</div>' +
      '</div>' +
      '<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:16px">' +
        '<div class="card" role="button" tabindex="0" data-action="orders">' +
          '<div class="icon">üì¶</div><div class="title">MY ORDERS</div><div class="tag tag-beta">TRACK</div>' +
        '</div>' +
        '<div class="card" role="button" tabindex="0" data-action="viewCart" aria-disabled="' + (cartCount? "false":"true") + '">' +
          '<div class="icon">üõí</div><div class="title">CART</div><div class="tag tag-neutral">' + cartCount + ' ITEMS</div>' +
        '</div>' +
      '</div>' +
      '<div style="text-align:center;margin-top:18px;color:#888;font-size:.85rem">Session: ' + esc(STATE.session) + '</div>' +
      '<div class="footer">' +
        '<a data-action="privacy">Privacy</a> ‚Ä¢ ' +
        '<a data-action="terms">Terms</a> ‚Ä¢ ' +
        '<a data-action="contact">Contact</a>' +
      '</div>';
  }
  
  function renderSellerCTA(){
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">Join Decide</div>' +
        '<div class="p">A clean, local-first way to get customers ‚Äî without commission.</div>' +
        '<div class="payment-box">' +
          '<div style="font-weight:900;font-size:1.1rem;margin-bottom:10px">Why join Decide?</div>' +
          '<div style="color:#bbb;line-height:1.7">' +
            '‚Ä¢ <b>No commission</b> like big apps<br />' +
            '‚Ä¢ <b>Direct customer connection</b> (you build trust)<br />' +
            '‚Ä¢ <b>Local-first discovery</b> (city + area matters)<br />' +
            '‚Ä¢ <b>No algorithm suppression</b> (transparent listing)<br />' +
          '</div>' +
        '</div>' +
        '<div class="payment-box">' +
          '<div style="font-weight:900;margin-bottom:10px">I want to join as</div>' +
          '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">' +
            '<button class="action" type="button" data-action="sellerForm" data-type="Food">üçΩÔ∏è Food</button>' +
            '<button class="secondary" type="button" data-action="sellerForm" data-type="Electronics">üõçÔ∏è Electronics</button>' +
          '</div>' +
          '<div style="height:10px"></div>' +
          '<button class="secondary" type="button" data-action="sellerForm" data-type="Services">üß∞ Services</button>' +
        '</div>' +
        '<button class="secondary" type="button" data-action="home">‚Üê HOME</button>' +
      '</div>';
  }
  
  function renderSellerForm(type){
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">Seller Interest</div>' +
        '<div class="p">Fast onboarding. You will be manually verified first.</div>' +
        '<div class="payment-box">' +
          '<div class="label">Category</div>' +
          '<div class="value" style="margin:6px 0 12px">' + esc(type) + '</div>' +
          '<div class="label">Business Name</div>' +
          '<input id="s_bname" placeholder="e.g. Rajkot Thali House" />' +
          '<div style="height:10px"></div>' +
          '<div class="label">City</div>' +
          '<input id="s_city" placeholder="e.g. Rajkot" />' +
          '<div style="height:10px"></div>' +
          '<div class="label">Phone (WhatsApp)</div>' +
          '<input id="s_phone" placeholder="e.g. 9XXXXXXXXX" />' +
          '<div style="height:10px"></div>' +
          '<div class="label">Your idea (optional)</div>' +
          '<textarea id="s_idea" placeholder="Tell us what you want Decide to build for you..."></textarea>' +
        '</div>' +
        '<button class="action" type="button" data-action="sellerSubmit" data-type="' + esc(type) + '">SUBMIT INTEREST</button>' +
        '<button class="secondary" type="button" data-action="seller">‚Üê BACK</button>' +
      '</div>';
  }
  
  function sellerSubmit(type){
    var b = (($("s_bname")||{}).value || "").trim();
    var c = (($("s_city")||{}).value || "").trim();
    var p = (($("s_phone")||{}).value || "").trim();
    var idea = (($("s_idea")||{}).value || "").trim();
    if(b.length < 2){ toast("Enter business name"); return; }
    if(c.length < 2){ toast("Enter city"); return; }
    if(p.length < 8){ toast("Enter valid phone"); return; }
    submitSellerInterest(type, b, c, p, idea).then(function(){ renderLobby(); });
  }
  
  function renderFeedbackCenter(){
    var list = [];
    try{
      list = JSON.parse(localStorage.getItem("feedback_items") || "[]");
      if(!Array.isArray(list)) list = [];
    }catch(e){ list = []; }
    
    var itemsHtml = list.slice().reverse().map(function(it){
      return (
        '<div class="result">' +
          '<div class="name" style="font-size:1rem">' + esc(it.title || "Feedback") + '</div>' +
          '<div style="color:#888;font-size:.85rem;margin-top:6px;line-height:1.6">' + esc(it.message || "") + '</div>' +
          '<div style="color:#666;font-size:.8rem;margin-top:10px">Saved: ' + esc(new Date(it.ts).toLocaleString("en-IN")) + '</div>' +
        '</div>'
      );
    }).join("");
    
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">Feedback Center</div>' +
        '<div class="p">Tell your ideas. This builds real UX connection.</div>' +
        '<div class="payment-box">' +
          '<div class="label">Title</div>' +
          '<input id="fb_title" placeholder="e.g. Add seller rating, Add swipe mode..." />' +
          '<div style="height:10px"></div>' +
          '<div class="label">Message</div>' +
          '<textarea id="fb_msg" placeholder="Write your idea in detail..."></textarea>' +
        '</div>' +
        '<button class="action" type="button" data-action="fbSubmit">SUBMIT FEEDBACK</button>' +
        '<button class="secondary" type="button" data-action="home" style="margin-top:10px">‚Üê HOME</button>' +
        '<div style="height:18px"></div>' +
        '<div class="p" style="margin-bottom:10px">Your saved feedback</div>' +
        (itemsHtml || '<div class="p">No feedback yet.</div>') +
      '</div>';
  }
  
  function fbSubmit(){
    var title = (($("fb_title")||{}).value || "").trim();
    var msg = (($("fb_msg")||{}).value || "").trim();
    if(msg.length < 5){ toast("Write a longer message"); return; }
    submitFeedback(title, msg).then(function(){ renderFeedbackCenter(); });
  }
  
  function renderCity(city){
    var cards = '';
    if(city === "Gandhidham"){
      cards += cardLink("üõçÔ∏è","E-COMMERCE","LIVE","tag-live","ecommerce");
    }else if(city === "Rajkot"){
      cards += cardLink("üçΩÔ∏è","FOOD","LIVE","tag-live","food");
    }else{
      toast("City coming soon");
      renderLobby();
      return;
    }
    
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">' + esc(city) + '</div>' +
        '<div class="p">Available modules</div>' +
        cards +
        '<button class="secondary" type="button" data-action="home">‚Üê HOME</button>' +
      '</div>';
    
    function cardLink(icon,title,status,tagClass,action){
      return (
        '<div class="card" role="button" tabindex="0" data-action="' + esc(action) + '" style="margin-bottom:12px">' +
          '<div class="icon">' + icon + '</div><div class="title">' + esc(title) + '</div><div class="tag ' + tagClass + '">' + esc(status) + '</div>' +
        '</div>'
      );
    }
  }
  
  function renderEcommerce(){
    STATE.domain = "ecommerce";
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">E-COMMERCE</div>' +
        '<div class="p">Gandhidham MVP ‚Ä¢ Choose category</div>' +
        '<div class="card" role="button" tabindex="0" data-action="category" data-cat="smartphones" style="margin-bottom:12px">' +
          '<div class="icon">üì±</div><div class="title">SMARTPHONES</div><div class="tag tag-live">AVAILABLE</div>' +
        '</div>' +
        '<div class="card" role="button" tabindex="0" data-action="category" data-cat="earbuds" style="margin-bottom:12px">' +
          '<div class="icon">üéß</div><div class="title">AUDIO DEVICES</div><div class="tag tag-live">AVAILABLE</div>' +
        '</div>' +
        '<div class="card" role="button" tabindex="0" data-action="category" data-cat="laptops" style="margin-bottom:12px">' +
          '<div class="icon">üíª</div><div class="title">LAPTOPS</div><div class="tag tag-live">AVAILABLE</div>' +
        '</div>' +
        '<button class="secondary" type="button" data-action="home">‚Üê HOME</button>' +
      '</div>';
  }
  
  function renderFilters(cat){
    STATE.domain = cat;
    STATE.lastEcomCategory = cat;
    STATE.filters = [];
    
    var filters = {
      smartphones:["cam","gam","bat"],
      earbuds:["snd","anc","mic"],
      laptops:["perf","port","scr"]
    };
    var labels = {
      cam:"CAMERA",gam:"GAMING",bat:"BATTERY",
      snd:"SOUND",anc:"NOISE",mic:"MIC",
      perf:"POWER",port:"TRAVEL",scr:"SCREEN"
    };
    
    var btns = (filters[cat] || []).map(function(f){
      return '<div class="filter-btn" role="button" tabindex="0" data-action="toggle" data-filter="' + f + '">' + labels[f] + '</div>';
    }).join("");
    
    $("app").innerHTML =
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">' + esc(cat) + '</div>' +
        '<div class="p">Pick priorities (tap)</div>' +
        '<div class="filter-grid">' + btns + '</div>' +
        '<button class="action" type="button" data-action="search">FIND BEST DEALS</button>' +
        '<button class="secondary" type="button" data-action="ecommerce" style="margin-top:10px">‚Üê BACK</button>' +
      '</div>';
  }
  
  function toggleFilter(key, el){
    var i = STATE.filters.indexOf(key);
    if(i >= 0){ STATE.filters.splice(i, 1); el.classList.remove("active"); }
    else { STATE.filters.push(key); el.classList.add("active"); }
  }
  
  function search(){
    var cat = STATE.domain;
    var db = DB[cat];
    if(!db || !Object.keys(db).length){ toast("No items"); return; }
    
    var all = [];
    Object.keys(db).forEach(function(name){
      (db[name] || []).forEach(function(seller){
        var score = 0;
        if(STATE.filters.length){
          STATE.filters.forEach(function(f){ score += (seller.attr && seller.attr[f]) ? seller.attr[f] : 0; });
        }
        all.push({
          type:"ecommerce",
          name:seller.name,
          price:seller.price,
          seller:seller.seller,
          rating:seller.rating,
          stock:seller.stock,
          delivery:seller.delivery,
          warranty:seller.warranty,
          city:seller.city,
          score:score
        });
      });
    });
    
    all.sort(function(a,b){
      if(b.score !== a.score) return b.score - a.score;
      return a.price - b.price;
    });
    
    RESULTS = all.slice(0,10);
    renderMarketplace();
  }
  
  function renderMarketplace(){
    if(!RESULTS.length){ toast("No results"); return; }
    
    var list = RESULTS.map(function(p, idx){
      var discount = Math.floor(Math.random()*20)+5;
      var original = p.price ? Math.floor(p.price/(1-discount/100)) : p.price;
      var stockColor = (p.stock > 50) ? "var(--accent)" : "#FFA726";
      
      return (
        '<div class="result">' +
          '<div class="row">' +
            '<div>' +
              '<div class="name">' + esc(p.name) + '</div>' +
              '<div class="seller">' +
                '<span class="badge">' + esc(p.seller) + '</span>' +
                '<span class="rating">‚≠ê ' + Number(p.rating||0).toFixed(1) + '</span>' +
                '<span class="badge">' + esc(p.city) + '</span>' +
              '</div>' +
            '</div>' +
            '<div class="price">' +
              '<div class="price-main">' + money(p.price) + '</div>' +
              '<div style="font-size:.9rem;color:#888;text-decoration:line-through;margin-top:5px">' + money(original) + '</div>' +
              '<div style="color:var(--accent);font-size:.85rem;font-weight:800;margin-top:5px">' + discount + '% OFF</div>' +
            '</div>' +
          '</div>' +
          '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0;padding:14px;background:rgba(255,255,255,0.03);border-radius:12px">' +
            '<div><div class="label">Stock</div><div class="value" style="color:' + stockColor + '">' + Number(p.stock||0) + ' units</div></div>' +
            '<div><div class="label">Delivery</div><div class="value">' + esc(p.delivery||"") + '</div></div>' +
            '<div><div class="label">Warranty</div><div class="value">' + esc(p.warranty||"") + '</div></div>' +
            '<div><div class="label">GST</div><div class="value" style="color:var(--accent)">Included ‚úì</div></div>' +
          '</div>' +
          '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">' +
            '<button class="action" type="button" data-action="buyEcom" data-idx="' + idx + '">BUY NOW</button>' +
            '<button class="secondary" type="button" data-action="addEcom" data-idx="' + idx + '">ADD TO CART</button>' +
          '</div>' +
        '</div>'
      );
    }).join("");
    
    $("app").innerHTML =
      '<div class="results">' +
        '<div style="text-align:center;margin-bottom:16px">' +
          '<h2 style="margin:0;font-size:1.6rem">BEST DEALS</h2>' +
          '<div class="p" style="margin:8px 0 0">Comparing ' + RESULTS.length + ' options</div>' +
        '</div>' +
        list +
        '<button class="secondary" type="button" data-action="category" data-cat="' + esc(STATE.lastEcomCategory || "smartphones") + '">‚Üê REFINE</button>' +
        '<button class="secondary" type="button" data-action="home" style="margin-top:10px">‚Üê HOME</button>' +
      '</div>';
  }
  
  function addEcom(idx){
    var p = RESULTS[idx]; if(!p) return;
    STATE.cart.push({ type:"ecommerce", name:p.name, seller:p.seller, price:Number(p.price)||0, qty:1 });
    saveCart();
    updateFloatingCart();
    toast("Added to cart");
  }
  
  function buyEcom(idx){
    var p = RESULTS[idx]; if(!p) return;
    STATE.cart = [{ type:"ecommerce", name:p.name, seller:p.seller, price:Number(p.price)||0, qty:1 }];
    saveCart();
    updateFloatingCart();
    viewCart();
  }
  
  function renderFood(){
    STATE.domain = "food";
    
    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>
      
      <div class="hero">
        <h1 class="hero-title">Order Food in Rajkot</h1>
        <p class="hero-subtitle">Fresh, Fast & Zero Commission. Support your local businesses.</p>
      </div>
      
      <div class="restaurant-grid">
        ${RESTAURANTS.map(r => `
          <div class="restaurant-card" data-action="restaurant" data-rid="${r.id}" role="button" tabindex="0">
            <div class="restaurant-image">
              <span style="position:relative;z-index:1">${r.icon}</span>
            </div>
            <div class="restaurant-info">
              <div class="restaurant-header">
                <div class="restaurant-name">${esc(r.name)}</div>
                <div class="restaurant-meta">
                  <div class="meta-item">
                    <span class="rating">‚≠ê ${r.rating}</span>
                  </div>
                  <div class="meta-item">‚è±Ô∏è ${r.prepTime} mins</div>
                  <div class="meta-item">üìç ${esc(r.area)}</div>
                </div>
              </div>
              <div class="restaurant-tags">
                ${r.tags.map(tag => `<span class="tag ${tag}">${tag}</span>`).join('')}
              </div>
              <div class="restaurant-footer">
                <div class="price-hint">
                  <span class="price-amount">${money(r.priceForTwo)}</span> for two
                </div>
                <button class="view-menu-btn">View Menu ‚Üí</button>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    
    $("app").innerHTML = html;
  }
  
  function viewRestaurant(id){
    const restaurant = RESTAURANTS.find(r => r.id === id);
    if(!restaurant) return;
    
    STATE.currentRestaurant = restaurant;
    
    const categories = ['all', ...new Set(restaurant.menu.map(item => item.category))];
    
    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>
      
      <div class="menu-header">
        <h1 class="menu-restaurant-name">${esc(restaurant.name)}</h1>
        <div class="menu-restaurant-meta">
          <span>‚≠ê ${restaurant.rating}</span>
          <span>‚Ä¢</span>
          <span>‚è±Ô∏è ${restaurant.prepTime} mins</span>
          <span>‚Ä¢</span>
          <span>üìç ${esc(restaurant.area)}</span>
        </div>
      </div>
      
      <div class="menu-categories">
        ${categories.map(cat => `
          <button class="category-btn ${STATE.filterCategory === cat ? 'active' : ''}"
                  data-action="filterCategory" data-cat="${cat}">
            ${cat.charAt(0).toUpperCase() + cat.slice(1)}
          </button>
        `).join('')}
      </div>
      
      <div class="menu-grid" id="menuGrid">
        ${renderMenuItems(restaurant.menu)}
      </div>
      
      <button class="secondary" data-action="food">‚Üê Back to Restaurants</button>
    `;
    
    $("app").innerHTML = html;
  }
  
  function renderMenuItems(items){
    const filtered = STATE.filterCategory === 'all' 
      ? items 
      : items.filter(item => item.category === STATE.filterCategory);
    
    return filtered.map(item => `
      <div class="menu-item">
        <div class="menu-item-header">
          <div class="menu-item-info">
            <div class="menu-item-name">${esc(item.name)}</div>
            <div class="menu-item-desc">${esc(item.desc)}</div>
          </div>
          <div class="menu-item-icon">${item.icon}</div>
        </div>
        <div class="menu-item-meta">
          ${item.veg ? '<span>üü¢ Veg</span>' : '<span>üî¥ Non-veg</span>'}
          <span>‚Ä¢</span>
          <span>‚è±Ô∏è ${item.prepMins} mins</span>
        </div>
        <div class="menu-item-footer">
          <div class="menu-item-price">${money(item.price)}</div>
          <button class="add-to-cart-btn" data-action="addToCart" data-item="${item.id}">
            <span>+</span>
            <span>Add</span>
          </button>
        </div>
      </div>
    `).join('');
  }
  
  function filterCategory(category){
    STATE.filterCategory = category;
    if(STATE.currentRestaurant){
      const grid = $("menuGrid");
      if(grid){
        grid.innerHTML = renderMenuItems(STATE.currentRestaurant.menu);
      }
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
        if(btn.getAttribute('data-cat') === category){
          btn.classList.add('active');
        }
      });
    }
  }
  
  function addToCart(itemId){
    if(!STATE.currentRestaurant) return;
    
    const item = STATE.currentRestaurant.menu.find(m => m.id === itemId);
    if(!item) return;
    
    STATE.cart.push({
      type: "food",
      restaurantId: STATE.currentRestaurant.id,
      restaurantName: STATE.currentRestaurant.name,
      name: item.name,
      price: item.price,
      icon: item.icon,
      upiId: STATE.currentRestaurant.upiId
    });
    
    saveCart();
    updateFloatingCart();
    toast('Added to cart!', 'success');
  }
  
  function removeFromCart(index){
    STATE.cart.splice(index, 1);
    saveCart();
    updateFloatingCart();
    if(STATE.cart.length === 0){
      renderLobby();
    }else{
      viewCart();
    }
  }
  
  function viewCart(){
    if(STATE.cart.length === 0){
      renderLobby();
      return;
    }
    
    const { subtotal, gst: tax, total, isFood } = calcCartTotals();
    
    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>
      
      <div class="cart-container">
        <div class="cart-items">
          <h2 class="cart-title">Your Cart (${STATE.cart.length} items)</h2>
          ${STATE.cart.map((item, idx) => `
            <div class="cart-item">
              <div style="font-size:2rem">${item.icon || 'üçΩÔ∏è'}</div>
              <div class="cart-item-info">
                <div class="cart-item-name">${esc(item.name)}</div>
                <div class="cart-item-seller">${esc(item.restaurantName || item.seller || '')}</div>
              </div>
              <div class="cart-item-price">${money(item.price)}</div>
              <button class="remove-btn" data-action="removeFromCart" data-idx="${idx}">Remove</button>
            </div>
          `).join('')}
        </div>
        
        <div class="cart-summary">
          <div class="summary-row">
            <span class="summary-label">Subtotal</span>
            <span class="summary-value">${money(subtotal)}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">${isFood ? 'GST (5%)' : 'GST (18%)'}</span>
            <span class="summary-value">${money(tax)}</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span>${money(total)}</span>
          </div>
        </div>
        
        ${isFood ? `
          <div class="payment-section">
            <h3 class="payment-title">Payment Method</h3>
            <div class="payment-methods">
              <div class="payment-method ${STATE.selectedPaymentMethod === 'razorpay' ? 'selected' : ''}"
                   data-action="selectPayment" data-method="razorpay" role="button" tabindex="0">
                <div class="payment-icon">üí≥</div>
                <div class="payment-info">
                  <div class="payment-name">Razorpay</div>
                  <div class="payment-desc">UPI, Cards, Wallets & More</div>
                </div>
                <span class="payment-badge">Instant</span>
              </div>
              <div class="payment-method ${STATE.selectedPaymentMethod === 'manual' ? 'selected' : ''}"
                   data-action="selectPayment" data-method="manual" role="button" tabindex="0">
                <div class="payment-icon">üì±</div>
                <div class="payment-info">
                  <div class="payment-name">Direct UPI</div>
                  <div class="payment-desc">Pay directly & save 2% fee</div>
                </div>
                <span class="payment-badge" style="background:#ffaa00">No Fee</span>
              </div>
            </div>
          </div>
        ` : ''}
        
        <button class="action" data-action="proceedToPayment">
          <span>Pay ${money(total)}</span>
          <span>‚Üí</span>
        </button>
        <button class="secondary" style="margin-top:12px" data-action="${isFood ? 'food' : 'home'}">
          ‚Üê Continue Shopping
        </button>
      </div>
    `;
    
    $("app").innerHTML = html;
  }
  
  function selectPayment(method){
    STATE.selectedPaymentMethod = method;
    viewCart();
  }
  
  function proceedToPayment(){
    const totals = calcCartTotals();
    const finalAmount = totals.total;
    STATE.lastPaymentAmount = finalAmount;

    if(totals.isFood){
      if(STATE.selectedPaymentMethod === 'razorpay'){
        initiateRazorpay(finalAmount);
      }else{
        initiateManualUPI(finalAmount);
      }
    }else{
      toast("E-commerce payment demo");
    }
  }
  
  function initiateRazorpay(amount){
    if(typeof Razorpay === 'undefined'){
      toast('Razorpay not loaded. Please refresh.', 'error');
      return;
    }
    
    const options = {
      key: RAZORPAY_KEY,
      amount: amount * 100,
      currency: 'INR',
      name: 'Decide - Rajkot Food',
      description: 'Food Order Payment',
      
      prefill: {
        name: 'Customer',
        email: 'customer@email.com',
        contact: '9876543210'
      },
      
      theme: {
        color: '#ff671f'
      },
      
      handler: function(response){
        const paymentId = response.razorpay_payment_id;
        completeOrder(paymentId, 'razorpay', amount);
      },
      
      modal: {
        ondismiss: function(){
          toast('Payment cancelled', 'error');
        }
      }
    };
    
    try{
      const rzp = new Razorpay(options);
      rzp.open();
    }catch(e){
      console.error('Razorpay error:', e);
      toast('Payment failed. Try manual UPI.', 'error');
    }
  }
  
  function initiateManualUPI(amount){
    const restaurant = RESTAURANTS.find(r => r.id === STATE.cart[0]?.restaurantId);
    if(!restaurant){
      toast('Restaurant not found', 'error');
      return;
    }

    console.log('Initiating UPI for amount:', amount);
    console.log('Restaurant:', restaurant.name);

    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>

      <div class="cart-container">
        <div class="payment-section" style="text-align:center">
          <div style="font-size:4rem;margin-bottom:16px">üì≤</div>
          <h2 class="payment-title">Pay via UPI</h2>

          <div style="font-size:2rem;font-weight:900;color:var(--brand-orange);margin:16px 0">
            ${money(amount)}
          </div>

          <div style="background:rgba(255,255,255,0.05);padding:20px;border-radius:16px;margin:24px 0">
            <div style="color:var(--text-secondary);margin-bottom:8px">Restaurant</div>
            <div style="font-size:1.1rem;font-weight:700;margin-bottom:16px">
              ${esc(restaurant.name)}
            </div>

            <div style="color:var(--text-secondary);margin-bottom:8px">UPI ID</div>
            <div style="font-size:1.25rem;font-weight:700;word-break:break-all;margin-bottom:4px">
              ${esc(restaurant.upiId)}
            </div>
            <div style="font-size:0.85rem;color:#888;margin-bottom:16px">
              (Account: ${esc(restaurant.upiAccountName || "Restaurant Owner")})
            </div>

            <button class="secondary" style="margin-top:8px" data-action="copyUPI" data-upi="${esc(restaurant.upiId)}">
              üìã Copy UPI ID
            </button>
          </div>

          <div class="info-box">
            ‚ÑπÔ∏è <b>Note:</b> Your UPI app will show the account holder's name "${esc(restaurant.upiAccountName || "")}" instead of the restaurant name. This is normal for personal UPI IDs. The payment goes to ${esc(restaurant.name)}.
          </div>

          <button class="action" data-action="openUPIApp" data-upi="${esc(restaurant.upiId)}" data-amount="${amount}">
            Pay ${money(amount)} ‚Üí
          </button>

          <div style="margin:24px 0;padding:20px;background:rgba(255,170,0,0.1);border:1px solid rgba(255,170,0,0.3);border-radius:16px">
            <div style="font-weight:700;margin-bottom:8px">After Payment:</div>
            <div style="color:var(--text-secondary);font-size:0.875rem;line-height:1.6">
              1. Complete payment in your UPI app<br>
              2. Note down your 12-digit UTR number<br>
              3. Come back and submit UTR
            </div>
          </div>

          <button class="action" style="background:var(--success)" data-action="submitUTRScreen">
            I Have Paid ‚Üí Submit UTR
          </button>

          <button class="secondary" style="margin-top:12px" data-action="viewCart">
            ‚Üê Back to Cart
          </button>
        </div>
      </div>
    `;

    $("app").innerHTML = html;
  }
  
  function copyUPI(upiId){
    try{
      navigator.clipboard.writeText(upiId);
      toast('UPI ID copied!', 'success');
    }catch(e){
      toast('Copy failed: ' + upiId, 'error');
    }
  }
  
  function openUPIApp(upiId, amount){
    const restaurant = RESTAURANTS.find(r => r.id === STATE.cart[0]?.restaurantId);
    const payeeName = restaurant ? restaurant.name : "Decide Food";
    const orderRef = STATE.lastTxnRef || ('TXN' + Date.now().toString(36).toUpperCase());
    STATE.lastTxnRef = orderRef;
    const am = Number(amount || 0).toFixed(2);

    const params = new URLSearchParams({
      pa: upiId,
      pn: payeeName,
      am: am,
      cu: 'INR',
      tn: 'Order ' + orderRef,
      tr: orderRef
    });

    const upiLink = 'upi://pay?' + params.toString();

    console.log('UPI Link:', upiLink);
    console.log('Amount:', am);
    console.log('UPI ID:', upiId);
    console.log('Payee:', payeeName);

    window.location.href = upiLink;
    toast('Opening UPI app...', 'success');
  }
  
  function submitUTRScreen(){
    const amount = Number(STATE.lastPaymentAmount || calcCartTotals().total || 0);

    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>

      <div class="cart-container">
        <div class="payment-section">
          <h2 class="payment-title">Submit UTR Number</h2>
          <p style="color:var(--text-secondary);margin-bottom:10px">
            Enter the 12-digit UTR number from your UPI transaction
          </p>
          <p style="color:var(--text-secondary);margin-bottom:24px">
            Amount paid: <b style="color:var(--brand-orange)">${money(amount)}</b>
          </p>

          <input type="text"
                 id="utrInput"
                 placeholder="Enter 12-digit UTR"
                 maxlength="12"
                 inputmode="numeric"
                 style="width:100%;padding:16px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:white;font-size:1.125rem;text-align:center;letter-spacing:2px;margin-bottom:24px">

          <button class="action" data-action="confirmUTR">
            Submit & Confirm Order
          </button>
          <button class="secondary" style="margin-top:12px" data-action="viewCart">
            ‚Üê Back
          </button>
        </div>
      </div>
    `;

    $("app").innerHTML = html;
    setTimeout(() => $("utrInput") && $("utrInput").focus(), 100);
  }
  
  function confirmUTR(){
    const utr = ($("utrInput")?.value || '').replace(/\s+/g, '');

    if(!/^\d{12}$/.test(utr)){
      toast('UTR must be exactly 12 digits', 'error');
      return;
    }

    var idx = loadUtrIndex();
    if(idx[utr]){
      toast('Duplicate UTR detected (already used)', 'error');
      return;
    }

    const amount = Number(STATE.lastPaymentAmount || calcCartTotals().total || 0);
    completeOrder(utr, 'manual_upi', amount);
  }
  
  function completeOrder(paymentId, method, amount){
    const orderId = 'DEC' + Date.now().toString(36).toUpperCase();
    
    const order = {
      id: orderId,
      items: STATE.cart.slice(),
      amount: amount,
      payment: {
        id: paymentId,
        method: method
      },
      status: 'confirmed',
      timestamp: new Date().toISOString()
    };
    
    try{
      const orders = JSON.parse(localStorage.getItem('decide_orders') || '[]');
      orders.push(order);
      localStorage.setItem('decide_orders', JSON.stringify(orders));
    }catch(e){}
    
    if(method === 'manual_upi'){
      var idx = loadUtrIndex();
      idx[paymentId] = { orderId: orderId, ts: new Date().toISOString() };
      saveUtrIndex(idx);
    }
    
    const restaurant = RESTAURANTS.find(r => r.id === STATE.cart[0]?.restaurantId);
    if(restaurant?.whatsapp){
      const msg = `New Order: ${orderId}%0AAmount: ‚Çπ${Math.round(amount)}%0APayment: ${method}%0AItems: ${STATE.cart.length}`;
      setTimeout(() => {
        try{
          window.open(restaurant.whatsapp + '?text=' + msg, '_blank');
        }catch(e){}
      }, 500);
    }
    
    STATE.cart = [];
    saveCart();
    updateFloatingCart();
    
    showSuccess(orderId);
  }
  
  function showSuccess(orderId){
    const html = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" type="button" data-action="home">HOME</button>
      </div>
      
      <div class="success-screen">
        <div class="success-icon">‚úì</div>
        <h1 class="success-title">Order Placed!</h1>
        <p style="color:var(--text-secondary);margin-bottom:24px">
          Your order has been confirmed and the restaurant has been notified.
        </p>
        <div class="success-order-id">
          <span>Order ID:</span>
          <span style="color:var(--success)">${esc(orderId)}</span>
        </div>
        <button class="action" data-action="food">
          Order More Food
        </button>
        <button class="secondary" style="margin-top:12px" data-action="home">
          ‚Üê Home
        </button>
      </div>
    `;
    
    $("app").innerHTML = html;
    
    setTimeout(() => {
      toast('üéâ Order confirmed!', 'success');
    }, 500);
  }
  
  function renderOrders(){
    loadOrders();
    if(!STATE.orders.length){ 
      toast("No orders yet"); 
      renderLobby(); 
      return; 
    }
    
    var list = STATE.orders.slice().reverse().map(function(o){
      var statusColor = (o.status === "delivered") ? "var(--accent)" : (o.status === "confirmed" || o.status === "preparing") ? "var(--brand-orange)" : "#888";
      return (
        '<div class="result">' +
          '<div class="row">' +
            '<div>' +
              '<div class="name" style="font-size:1.05rem">' + esc(o.id) + '</div>' +
              '<div style="color:#888;font-size:.85rem;margin-top:6px">' + esc(new Date(o.timestamp).toLocaleString("en-IN")) + '</div>' +
            '</div>' +
            '<div style="text-align:right">' +
              '<div style="font-weight:900;color:var(--brand-orange)">' + money(o.amount||0) + '</div>' +
              '<div style="margin-top:6px;font-weight:900;color:' + statusColor + ';font-size:.85rem">' + esc(String(o.status||"").toUpperCase()) + '</div>' +
            '</div>' +
          '</div>' +
        '</div>'
      );
    }).join("");
    
    $("app").innerHTML =
      '<div class="header">' +
        '<div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>' +
        '<button class="btn" type="button" data-action="home">HOME</button>' +
      '</div>' +
      '<div class="wrap">' +
        '<div class="hero-title" style="font-size:2rem">MY ORDERS</div>' +
        '<div class="p">Your order history</div>' +
        list +
        '<button class="secondary" type="button" data-action="home">‚Üê HOME</button>' +
      '</div>';
  }
  
  // ======================
  // STATIC PAGES
  // ======================
  function renderPrivacy(){
    $("app").innerHTML = `
      <div class="static-page">
        <div class="header">
          <div class="header-badge">DECIDE</div>
          <button class="btn" type="button" data-action="home">HOME</button>
        </div>
        <div class="static-hero">
          <h1>Privacy Policy</h1>
          <div class="static-meta">
            Last updated: <code>February 2026</code><br/>
            Decide ("we", "our", "platform") is a technology platform enabling users to discover, compare, and transact with independent sellers.
          </div>
          <div class="note">
            We do <b>not</b> store full card details. Payments are processed by certified third-party providers.
          </div>
          <div class="kv">
            <div class="pill"><strong>Email:</strong> privacy@decide.app</div>
            <div class="pill"><strong>Support:</strong> support@decide.app</div>
          </div>
        </div>
        
        <div class="static-card">
          <h2>1) Information We Collect</h2>
          <ul>
            <li>Contact details (email, phone if provided)</li>
            <li>Order and transaction metadata</li>
            <li>Device and usage analytics</li>
            <li>Communication records (support, feedback)</li>
          </ul>
        </div>

        <div class="static-card">
          <h2>2) Purpose of Processing</h2>
          <ul>
            <li>Enable transactions and order fulfillment</li>
            <li>Customer support</li>
            <li>Improve platform performance and recommendations</li>
            <li>Fraud prevention and abuse control</li>
          </ul>
        </div>

        <div class="static-card">
          <h2>3) Legal Basis (India)</h2>
          <ul>
            <li>User consent</li>
            <li>Contractual necessity (orders and services)</li>
            <li>Legitimate business interest</li>
          </ul>
        </div>

        <div class="static-card">
          <h2>4) Data Sharing</h2>
          <p>We may share limited data with sellers fulfilling orders, logistics partners, payment processors, and infrastructure/analytics providers. We do not sell personal data.</p>
        </div>

        <div class="static-card">
          <h2>5) Retention</h2>
          <p>We retain data only as long as necessary for transactions, legal obligations, and fraud prevention.</p>
        </div>

        <div class="static-card">
          <h2>6) Your Rights</h2>
          <p>You may request access, correction, or deletion via <code>privacy@decide.app</code>.</p>
        </div>

        <div class="static-card">
          <h2>7) Security</h2>
          <p>We implement standard technical and organizational safeguards appropriate for an early-stage platform.</p>
        </div>

        <div class="static-card">
          <h2>8) Children</h2>
          <p>Decide is not intended for users under 18.</p>
        </div>

        <div class="static-card">
          <h2>9) Updates</h2>
          <p>We may update this policy periodically. Continued use means you accept the updated policy.</p>
        </div>

        <div class="footer">
          <a data-action="privacy">Privacy</a> ‚Ä¢
          <a data-action="terms">Terms</a> ‚Ä¢
          <a data-action="contact">Contact</a> ‚Ä¢
          <a data-action="cookies">Cookies</a>
        </div>
      </div>
    `;
  }

  function renderTerms(){
    $("app").innerHTML = `
      <div class="static-page">
        <div class="header">
          <div class="header-badge">DECIDE</div>
          <button class="btn" type="button" data-action="home">HOME</button>
        </div>
        <div class="static-hero">
          <h1>Terms of Service</h1>
          <div class="static-meta">
            Last updated: <code>February 2026</code><br/>
            By using Decide, you agree to these terms.
          </div>
          <div class="note">
            Decide is a technology intermediary. Sellers are responsible for fulfillment.
          </div>
        </div>

        <div class="static-card">
          <h2>1) Platform Role</h2>
          <p>Decide connects buyers and independent sellers. We do not own or manufacture listed products.</p>
        </div>

        <div class="static-card">
          <h2>2) Orders and Payments</h2>
          <p>Payments are processed via third-party providers. Order fulfillment is the responsibility of sellers and/or logistics partners.</p>
        </div>

        <div class="static-card">
          <h2>3) ONDC / Network Transactions</h2>
          <p>For network-enabled transactions (including ONDC), Decide facilitates communication between parties as a participant node. Contractual obligations remain between buyer and seller.</p>
        </div>

        <div class="static-card">
          <h2>4) Pricing and Listings</h2>
          <p>Product information is provided by sellers. We strive for accuracy but do not guarantee completeness.</p>
        </div>

        <div class="static-card">
          <h2>5) User Conduct</h2>
          <ul>
            <li>No misuse of the platform</li>
            <li>No unauthorized access attempts</li>
            <li>No interference with services</li>
          </ul>
        </div>

        <div class="static-card">
          <h2>6) Limitation of Liability</h2>
          <p>To the maximum extent permitted by law, Decide is not liable for seller performance issues, delivery delays, or indirect or consequential damages.</p>
        </div>

        <div class="static-card">
          <h2>7) Termination</h2>
          <p>We may suspend or terminate access for violations or risk activity.</p>
        </div>

        <div class="static-card">
          <h2>8) Governing Law</h2>
          <p>These terms are governed by the laws of India.</p>
        </div>

        <div class="static-card">
          <h2>9) Contact</h2>
          <p>Email: <code>legal@decide.app</code></p>
        </div>

        <div class="footer">
          <a data-action="privacy">Privacy</a> ‚Ä¢
          <a data-action="terms">Terms</a> ‚Ä¢
          <a data-action="contact">Contact</a> ‚Ä¢
          <a data-action="cookies">Cookies</a>
        </div>
      </div>
    `;
  }

  function renderContact(){
    $("app").innerHTML = `
      <div class="static-page">
        <div class="header">
          <div class="header-badge">DECIDE</div>
          <button class="btn" type="button" data-action="home">HOME</button>
        </div>
        <div class="static-hero">
          <h1>Contact</h1>
          <div class="static-meta">Support, partnerships, seller onboarding, and legal requests.</div>
        </div>

        <div class="static-card">
          <h2>Reach us</h2>
          <div style="display:grid;gap:10px;margin-top:10px">
            <div class="item">
              <div class="label">Support</div>
              <div class="value"><code>support@decide.app</code></div>
              <p style="margin-top:8px;color:var(--text-secondary)">For order issues, refunds (as applicable), and app support.</p>
            </div>

            <div class="item">
              <div class="label">Seller onboarding</div>
              <div class="value"><code>sellers@decide.app</code></div>
              <p style="margin-top:8px;color:var(--text-secondary)">For restaurants and local businesses joining Rajkot and Gujarat launch.</p>
            </div>

            <div class="item">
              <div class="label">Legal & policy</div>
              <div class="value"><code>legal@decide.app</code></div>
              <p style="margin-top:8px;color:var(--text-secondary)">For compliance, notices, and policy questions.</p>
            </div>

            <div class="item">
              <div class="label">Privacy</div>
              <div class="value"><code>privacy@decide.app</code></div>
              <p style="margin-top:8px;color:var(--text-secondary)">For data access, correction, or deletion requests.</p>
            </div>
          </div>

          <div class="actions">
            <a class="action" href="mailto:support@decide.app?subject=Decide%20Support">Email Support</a>
            <a class="secondary" href="mailto:sellers@decide.app?subject=Seller%20Onboarding">Become a Seller</a>
          </div>
        </div>

        <div class="footer">
          <a data-action="privacy">Privacy</a> ‚Ä¢
          <a data-action="terms">Terms</a> ‚Ä¢
          <a data-action="contact">Contact</a> ‚Ä¢
          <a data-action="cookies">Cookies</a>
        </div>
      </div>
    `;
  }

  function renderCookies(){
    $("app").innerHTML = `
      <div class="static-page">
        <div class="header">
          <div class="header-badge">DECIDE</div>
          <button class="btn" type="button" data-action="home">HOME</button>
        </div>
        <div class="static-hero">
          <h1>Cookie Policy</h1>
          <div class="static-meta">Last updated: <code>February 2026</code></div>
        </div>

        <div class="static-card">
          <h2>1) What are cookies</h2>
          <p>Cookies are small files stored on your device to improve performance and user experience.</p>
        </div>

        <div class="static-card">
          <h2>2) How we use cookies</h2>
          <ul>
            <li>Session management</li>
            <li>Analytics</li>
            <li>Security</li>
            <li>Preferences</li>
          </ul>
        </div>

        <div class="static-card">
          <h2>3) Third-party cookies</h2>
          <p>Some cookies may be placed by analytics providers or payment processors.</p>
        </div>

        <div class="static-card">
          <h2>4) Your choices</h2>
          <p>You can disable cookies via browser settings, though some features may not work correctly.</p>
        </div>

        <div class="static-card">
          <h2>5) Contact</h2>
          <p>Email: <code>privacy@decide.app</code></p>
        </div>

        <div class="footer">
          <a data-action="privacy">Privacy</a> ‚Ä¢
          <a data-action="terms">Terms</a> ‚Ä¢
          <a data-action="contact">Contact</a> ‚Ä¢
          <a data-action="cookies">Cookies</a>
        </div>
      </div>
    `;
  }
  
  function goHome(){
    if(isVisited()) renderLobby();
    else renderLanding();
  }
  
  function handle(el){
    var action = el.getAttribute("data-action");
    if(!action || action === "disabled") return;
    if(el.getAttribute("aria-disabled") === "true") return;
    
    // Static pages routing
    if(action === "privacy"){ renderPrivacy(); return; }
    if(action === "terms"){ renderTerms(); return; }
    if(action === "contact"){ renderContact(); return; }
    if(action === "cookies"){ renderCookies(); return; }
    
    if(action === "home"){ goHome(); return; }
    if(action === "lobby"){ markVisited(); renderLobby(); return; }
    if(action === "waitlistSubmit"){ submitWaitlist(); return; }
    
    if(action === "module"){
      var mod = el.getAttribute("data-module");
      if(mod === "ecommerce") { renderEcommerce(); return; }
      if(mod === "food") { renderFood(); return; }
      toast("Module coming soon");
      return;
    }
    if(action === "city"){ renderCity(el.getAttribute("data-city")); return; }
    
    if(action === "seller"){ renderSellerCTA(); return; }
    if(action === "sellerForm"){ renderSellerForm(el.getAttribute("data-type") || "Seller"); return; }
    if(action === "sellerSubmit"){ sellerSubmit(el.getAttribute("data-type") || "Seller"); return; }
    
    if(action === "feedback"){ renderFeedbackCenter(); return; }
    if(action === "fbSubmit"){ fbSubmit(); return; }
    
    if(action === "ecommerce"){ renderEcommerce(); return; }
    if(action === "category"){ renderFilters(el.getAttribute("data-cat")); return; }
    if(action === "toggle"){ toggleFilter(el.getAttribute("data-filter"), el); return; }
    if(action === "search"){ search(); return; }
    if(action === "addEcom"){ addEcom(Number(el.getAttribute("data-idx"))); return; }
    if(action === "buyEcom"){ buyEcom(Number(el.getAttribute("data-idx"))); return; }
    
    if(action === "food"){ renderFood(); return; }
    if(action === "restaurant"){ viewRestaurant(el.getAttribute("data-rid")); return; }
    if(action === "filterCategory"){ filterCategory(el.getAttribute("data-cat")); return; }
    if(action === "addToCart"){ addToCart(el.getAttribute("data-item")); return; }
    
    if(action === "viewCart"){ viewCart(); return; }
    if(action === "removeFromCart"){ removeFromCart(Number(el.getAttribute("data-idx"))); return; }
    if(action === "selectPayment"){ selectPayment(el.getAttribute("data-method")); return; }
    if(action === "proceedToPayment"){ proceedToPayment(); return; }
    if(action === "copyUPI"){ copyUPI(el.getAttribute("data-upi")); return; }
    if(action === "openUPIApp"){ openUPIApp(el.getAttribute("data-upi"), Number(el.getAttribute("data-amount"))); return; }
    if(action === "submitUTRScreen"){ submitUTRScreen(); return; }
    if(action === "confirmUTR"){ confirmUTR(); return; }
    
    if(action === "orders"){ renderOrders(); return; }
  }
  
  document.addEventListener("click", function(e){
    var el = e.target.closest("[data-action]");
    if(el) handle(el);
  });
  
  document.addEventListener("keydown", function(e){
    if(e.key !== "Enter" && e.key !== " ") return;
    var el = e.target.closest("[data-action][role='button']");
    if(!el) return;
    e.preventDefault();
    handle(el);
  });
  
  function init(){
    sbClient = initSupabase();
    loadOrders();
    loadCart();
    loadToMemory(ECOMMERCE_DATA);
    updateFloatingCart();
    
    const fc = $("floatingCart");
    if(fc){
      fc.addEventListener('click', viewCart);
    }
    
    if(isVisited()) {
      renderLobby();
    } else {
      renderLanding();
    }
  }
  
  if(document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", function(){
      setTimeout(init, 100);
    }, {once:true});
  } else {
    setTimeout(init, 100);
  }
  
})();
</script>

</body>
</html>
