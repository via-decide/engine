<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Decide - India's Smart Marketplace</title>
<meta name="theme-color" content="#ff671f">
<link rel="manifest" href="manifest-ondc.json">
<script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{--brand-orange:#ff671f;--border:rgba(255,255,255,0.15);--accent:#00e676;--ondc-blue:#1e88e5;--font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;--safe-bottom:env(safe-area-inset-bottom,0px)}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;min-height:100%;background:#000;color:#fff;font-family:var(--font);-webkit-font-smoothing:antialiased}
button{font:inherit;-webkit-tap-highlight-color:transparent}
button:focus{outline:none}
[role="button"],.card,.filter-btn,.payment-option{-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
#app{min-height:100vh;display:flex;flex-direction:column;padding:20px;padding-bottom:calc(80px + var(--safe-bottom))}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:30px;gap:15px}
.header-badge{background:rgba(255,103,31,0.1);border:2px solid var(--brand-orange);padding:12px 24px;border-radius:12px;font-size:.85rem;font-weight:800;letter-spacing:1px;color:var(--brand-orange);display:flex;align-items:center;gap:10px;flex:1}
.status-dot{width:10px;height:10px;background:var(--accent);border-radius:50%;box-shadow:0 0 10px var(--accent);animation:pulse 2s infinite;display:inline-block}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.btn{background:transparent;border:2px solid rgba(255,255,255,0.3);padding:12px 30px;border-radius:50px;font-size:.9rem;font-weight:800;color:#fff;cursor:pointer;transition:.2s}
.btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.5)}
.btn:focus-visible,.card:focus-visible,.filter-btn:focus-visible,.payment-option:focus-visible{outline:3px solid rgba(255,103,31,.75);outline-offset:3px}
.two-col-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px}
.left-col{display:flex;flex-direction:column;gap:15px}
.right-col{display:flex;flex-direction:column;gap:15px}
.col-header{text-align:center;font-size:.75rem;font-weight:900;letter-spacing:1.5px;color:#888;padding:10px 0;border-bottom:1px solid var(--border);margin-bottom:5px}
.card{background:rgba(20,20,20,0.6);border:1px solid var(--border);border-radius:24px;padding:25px 20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:.2s;min-height:150px}
.card:hover{background:rgba(40,40,40,0.8);border-color:rgba(255,255,255,0.3);transform:translateY(-4px)}
.card[aria-disabled="true"]{opacity:.4;cursor:not-allowed;pointer-events:none}
.icon{font-size:3rem}
.title{font-size:1rem;font-weight:900;letter-spacing:.5px;text-align:center;margin:0;line-height:1.2}
.tag{font-size:.7rem;font-weight:800;letter-spacing:1.2px;padding:4px 10px;border-radius:6px;text-align:center}
.tag-live{color:var(--accent);background:rgba(0,230,118,0.15)}
.tag-neutral{color:#888;background:rgba(136,136,136,0.15)}
.tag-soon{color:#FFA726;background:rgba(255,167,38,0.15)}
.tag-beta{color:#4CAF50;background:rgba(76,175,80,0.15)}
.tag-city{color:#42A5F5;background:rgba(66,165,245,0.15)}
.action-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px}
.bottom{width:100%;background:transparent;border:2px solid rgba(255,255,255,0.2);padding:18px;border-radius:20px;font-size:1rem;font-weight:900;color:#fff;cursor:pointer;transition:.2s;margin-bottom:20px}
.bottom:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.4)}
.wrap{max-width:700px;margin:0 auto;width:100%}
.h1{font-size:1.8rem;font-weight:900;margin:0 0 20px;text-align:center;text-transform:uppercase}
.p{text-align:center;color:#888;margin:0 0 25px}
.filter-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:25px}
.filter-btn{background:rgba(20,20,20,0.6);border:2px solid var(--border);padding:25px;border-radius:18px;text-align:center;font-weight:900;font-size:1rem;cursor:pointer;transition:.2s;text-transform:uppercase}
.filter-btn:hover{background:rgba(40,40,40,0.8);border-color:rgba(255,255,255,0.3)}
.filter-btn.active{background:var(--brand-orange);color:#000;border-color:var(--brand-orange)}
.action{background:var(--brand-orange);color:#000;border:none;padding:18px;border-radius:18px;font-weight:900;font-size:1rem;cursor:pointer;width:100%;margin-bottom:12px;transition:.2s;text-transform:uppercase}
.action:hover{background:#ff7d3f;transform:translateY(-2px)}
.secondary{background:transparent;color:#fff;border:2px solid var(--border);padding:16px;border-radius:18px;font-weight:900;font-size:.95rem;cursor:pointer;width:100%;transition:.2s;text-transform:uppercase}
.secondary:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.3)}
.results{max-width:800px;margin:0 auto;padding:20px 0}
.result{background:rgba(20,20,20,0.6);border:1px solid var(--border);border-radius:18px;padding:20px;margin-bottom:15px;transition:.2s}
.result:hover{background:rgba(30,30,30,0.8);border-color:rgba(255,255,255,0.3)}
.row{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
.name{font-size:1.2rem;font-weight:900;margin:0 0 5px}
.seller{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.badge{background:rgba(30,136,229,0.2);color:var(--ondc-blue);padding:4px 10px;border-radius:6px;font-size:.75rem;font-weight:800}
.rating{color:#FFA726;font-size:.85rem}
.price{text-align:right}
.price-main{font-size:1.8rem;font-weight:900;color:var(--brand-orange)}
.details{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:15px 0;padding:15px;background:rgba(255,255,255,0.03);border-radius:12px}
.label{color:#888;font-size:.85rem}
.value{font-weight:800;font-size:.9rem}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.buy{background:var(--brand-orange);color:#000;border:none;padding:12px;border-radius:12px;font-weight:900;cursor:pointer;transition:.2s}
.buy:hover{background:#ff7d3f;transform:translateY(-2px)}
.add{background:transparent;color:#fff;border:1px solid var(--border);padding:12px;border-radius:12px;font-weight:800;cursor:pointer;transition:.2s}
.add:hover{background:rgba(255,255,255,0.1)}
.payment-option{background:rgba(255,255,255,0.03);border:2px solid var(--border);padding:15px;border-radius:12px;display:flex;align-items:center;gap:15px;cursor:pointer;transition:.2s}
.payment-option:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.3)}
.payment-option.selected{border-color:var(--brand-orange);background:rgba(255,103,31,0.1)}
.tracking-status{background:rgba(255,103,31,0.08);border:1px solid var(--border);border-radius:18px;padding:20px;margin-bottom:20px}
.tracking-timeline{position:relative;padding:20px 0}
.timeline-item{position:relative;padding-left:50px;padding-bottom:25px}
.timeline-item:last-child{padding-bottom:0}
.timeline-dot{position:absolute;left:0;width:30px;height:30px;background:#555;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem}
.timeline-item.active .timeline-dot{background:var(--accent);box-shadow:0 0 15px var(--accent)}
.timeline-line{position:absolute;left:15px;top:30px;width:2px;height:calc(100% - 30px);background:#333}
.timeline-item.active .timeline-line{background:var(--accent)}
.timeline-item:last-child .timeline-line{display:none}
.timeline-content{font-weight:900;margin-bottom:5px}
.timeline-time{font-size:0.85rem;color:#888}
.toast{position:fixed;bottom:calc(40px + var(--safe-bottom));left:50%;transform:translateX(-50%);background:#111;border:1px solid #333;padding:12px 24px;border-radius:30px;font-size:.85rem;opacity:0;transition:opacity .2s;z-index:1000}
.toast.show{opacity:1}
@media (max-width:600px){.two-col-grid{grid-template-columns:1fr;gap:20px}.card{padding:20px 15px;min-height:130px}.icon{font-size:2.5rem}.title{font-size:.95rem}.details{grid-template-columns:1fr}.actions{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="app"></div>
<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
<script>
(function(){
"use strict";

function $(id){return document.getElementById(id)}
function esc(s){
  s=String(s==null?"":s);
  return s.replace(/&/g,"&amp;")
          .replace(/</g,"&lt;")
          .replace(/>/g,"&gt;")
          .replace(/"/g,"&quot;")
          .replace(/'/g,"&#039;");
}
function toast(msg){
  var t=$("toast"); if(!t) return;
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2200);
}

/* =========================
   TEST UPI
========================= */
const TEST_UPI = "6351537770@yapl";

/* =========================
   STATE
========================= */
var STATE = {
  cart: [],
  orders: []
};

/* =========================
   LOAD / SAVE ORDERS
========================= */
function loadOrders(){
  try{
    var x=JSON.parse(localStorage.getItem("order_history")||"[]");
    STATE.orders=Array.isArray(x)?x:[];
  }catch(e){STATE.orders=[]}
}
function saveOrders(){
  localStorage.setItem("order_history",JSON.stringify(STATE.orders));
}

/* =========================
   UTR VALIDATION
========================= */
function isValidUTR(utr){
  if(!utr) return false;
  utr = utr.trim();
  return /^[0-9]{12}$/.test(utr);
}

function isDuplicateUTR(utr){
  for(var i=0;i<STATE.orders.length;i++){
    if(STATE.orders[i].utr === utr){
      return true;
    }
  }
  return false;
}

/* =========================
   PAYMENT FLOW
========================= */

function copyUpi(){
  navigator.clipboard.writeText(TEST_UPI);
  toast("UPI ID copied!");
}

function openUpiApp(amount){
  var link="upi://pay?pa="+encodeURIComponent(TEST_UPI)
           +"&pn=Decide"
           +"&am="+amount
           +"&cu=INR"
           +"&tn=Decide Order";
  window.location.href=link;
}

function submitUtrScreen(total){
  $("app").innerHTML=
  '<div class="wrap">'+
  '<div class="h1">Submit UTR</div>'+
  '<div class="p">Total Paid: ₹'+total+'</div>'+
  '<div class="result" style="padding:25px">'+
  '<input type="text" id="utrNumber" placeholder="Enter 12-digit UTR" maxlength="12" style="width:100%;padding:15px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:12px;color:#fff;font-size:1.1rem;text-align:center;letter-spacing:2px;margin-bottom:20px">'+
  '</div>'+
  '<button class="action" onclick="confirmUTR('+total+')">CONFIRM UTR</button>'+
  '</div>';
}

window.confirmUTR = function(total){
  loadOrders();
  var input = $("utrNumber");
  var utr = input.value.trim();

  if(!isValidUTR(utr)){
    toast("Invalid UTR. Must be 12 digits.");
    return;
  }

  if(isDuplicateUTR(utr)){
    toast("Duplicate UTR detected!");
    return;
  }

  var id="DEC-"+Math.random().toString(36).slice(2,6).toUpperCase();

  var order={
    id:id,
    total:total,
    utr:utr,
    status:"utr_submitted",
    timestamp:new Date().toISOString()
  };

  STATE.orders.push(order);
  saveOrders();

  $("app").innerHTML=
  '<div class="wrap" style="text-align:center;margin-top:40px">'+
  '<div style="font-size:5rem;margin-bottom:20px">⏳</div>'+
  '<div class="h1">UTR SUBMITTED</div>'+
  '<div class="p">Order ID: '+esc(id)+'</div>'+
  '<div class="p">Awaiting seller confirmation</div>'+
  '</div>';

  toast("UTR submitted securely!");
}

/* =========================
   DEMO ORDER SCREEN
========================= */

window.startDemoPayment = function(){
  var total = 150; // example
  $("app").innerHTML=
  '<div class="wrap">'+
  '<div class="h1">Pay ₹'+total+'</div>'+
  '<div class="result" style="text-align:center;padding:30px">'+
  '<div style="font-size:1rem;margin-bottom:10px">UPI ID</div>'+
  '<div style="font-weight:900;margin-bottom:20px">'+TEST_UPI+'</div>'+
  '<button class="secondary" onclick="copyUpi()">COPY UPI</button>'+
  '<button class="action" style="margin-top:15px" onclick="openUpiApp('+total+')">OPEN UPI APP</button>'+
  '<button class="action" style="margin-top:15px;background:#00e676" onclick="submitUtrScreen('+total+')">I HAVE PAID</button>'+
  '</div>'+
  '</div>';
}

/* =========================
   INIT
========================= */
function init(){
  loadOrders();
  $("app").innerHTML=
  '<div class="wrap">'+
  '<div class="h1">Decide Payment Test</div>'+
  '<button class="action" onclick="startDemoPayment()">START TEST ORDER</button>'+
  '</div>';
}

document.addEventListener("DOMContentLoaded",init);

})();
</script>
</body>
</html>
