<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Decide - India's Smart Marketplace</title>
<meta name="description" content="India's first commission-free marketplace. Compare products by YOUR priorities. Starting in Gujarat - Gandhidham & Rajkot." />
<meta name="theme-color" content="#ff671f" />

<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/x-icon" href="/favicon.ico" />

<link rel="manifest" href="/manifest.json" />

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --brand-orange:#ff671f;
  --brand-orange-light:#ff8547;
  --bg-card:rgba(20,20,20,0.6);
  --bg-card-hover:rgba(40,40,40,0.8);
  --border:rgba(255,255,255,0.15);
  --accent:#00e676;
  --ondc-blue:#1e88e5;
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --radius-md: 16px;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;padding:0;min-height:100%;background:#000;color:#fff;font-family:var(--font);-webkit-font-smoothing:antialiased}
button,input,textarea{font:inherit}
button{background:none;border:none;color:inherit;cursor:pointer}
button:focus{outline:none}
[role="button"],.card,.filter-btn,.payment-option{-webkit-tap-highlight-color:transparent;user-select:none;-webkit-user-select:none}
#app{min-height:100vh;display:flex;flex-direction:column;padding:20px;padding-bottom:calc(80px + var(--safe-bottom))}

/* HEADER */
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:15px}
.header-badge{
  background:rgba(255,103,31,0.1);
  border:2px solid var(--brand-orange);
  padding:12px 18px;border-radius:12px;
  font-size:.85rem;font-weight:800;letter-spacing:1px;
  color:var(--brand-orange);
  display:flex;align-items:center;gap:10px;flex:1;
}
.status-dot{width:10px;height:10px;background:var(--accent);border-radius:50%;box-shadow:0 0 10px var(--accent);animation:pulse 2s infinite;display:inline-block}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.btn{
  background:transparent;border:2px solid rgba(255,255,255,0.3);
  padding:10px 18px;border-radius:50px;font-size:.85rem;
  font-weight:800;color:#fff;transition:.2s;
}
.btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.5)}

/* LAYOUT */
.two-col-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:18px}
.left-col,.right-col{display:flex;flex-direction:column;gap:14px}
.col-header{text-align:center;font-size:.72rem;font-weight:900;letter-spacing:1.5px;color:#888;padding:10px 0;border-bottom:1px solid var(--border);margin-bottom:4px}

/* COMMON CARDS */
.card{
  background:var(--bg-card);border:1px solid var(--border);
  border-radius:22px;padding:20px 16px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:10px;cursor:pointer;transition:.2s;min-height:120px;
}
.card:hover{background:var(--bg-card-hover);border-color:rgba(255,255,255,0.3);transform:translateY(-3px)}
.icon{font-size:2.6rem}
.title{font-size:1rem;font-weight:900;letter-spacing:.5px;text-align:center;margin:0;line-height:1.2}
.tag{font-size:.7rem;font-weight:800;letter-spacing:1.2px;padding:4px 10px;border-radius:8px;text-align:center}
.tag-live{color:var(--accent);background:rgba(0,230,118,0.15)}
.tag-neutral{color:#888;background:rgba(136,136,136,0.15)}
.tag-city{color:#42A5F5;background:rgba(66,165,245,0.15)}

/* FOOD SPECIFIC UI (INTEGRATED) */
.restaurant-card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 18px; overflow: hidden; margin-bottom: 16px;
  transition: all 0.2s; cursor: pointer;
}
.restaurant-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.3); }
.restaurant-image {
  height: 140px; background: linear-gradient(135deg, rgba(255,103,31,0.2), rgba(0,0,0,0));
  display: flex; align-items: center; justify-content: center; font-size: 3rem;
}
.restaurant-info { padding: 16px; }
.restaurant-name { font-size: 1.2rem; font-weight: 900; margin-bottom: 6px; }
.restaurant-meta { display: flex; gap: 12px; font-size: 0.85rem; color: #aaa; margin-bottom: 10px; }
.restaurant-tags { display: flex; gap: 6px; flex-wrap: wrap; }
.food-tag { 
  font-size: 0.7rem; padding: 4px 10px; border-radius: 99px; 
  background: rgba(255,255,255,0.08); color: #ccc; 
}

/* MENU UI */
.menu-categories { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 12px; margin-bottom: 16px; scrollbar-width: none; }
.category-btn {
  padding: 8px 18px; border-radius: 99px; background: var(--bg-card); border: 1px solid var(--border);
  color: #aaa; font-weight: 700; white-space: nowrap; transition: 0.2s;
}
.category-btn.active { background: var(--brand-orange); color: #000; border-color: var(--brand-orange); }

.menu-item {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 16px; margin-bottom: 12px; display: flex; flex-direction: column;
}
.menu-item-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
.menu-item-name { font-size: 1.1rem; font-weight: 700; }
.menu-item-price { font-size: 1.2rem; font-weight: 900; color: var(--brand-orange); }
.add-btn {
  background: var(--brand-orange); color: #000; padding: 6px 16px; border-radius: 99px;
  font-weight: 800; font-size: 0.8rem;
}

/* CART & PAYMENTS */
.payment-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 18px; padding: 18px; margin-bottom: 14px; }
.payment-option {
  display: flex; align-items: center; gap: 12px; padding: 14px;
  border-radius: 14px; border: 1px solid var(--border); margin-bottom: 10px; cursor: pointer;
}
.payment-option.selected { border-color: var(--brand-orange); background: rgba(255,103,31,0.10); }

/* UTILS */
.wrap{max-width:760px;margin:0 auto;width:100%}
.h1{font-size:1.7rem;font-weight:900;margin:0 0 14px;text-align:center;text-transform:uppercase}
.p{text-align:center;color:#888;margin:0 0 18px;line-height:1.55}
.action{
  background:var(--brand-orange);color:#000;border:none;padding:16px;border-radius:16px;
  font-weight:900;font-size:1rem;cursor:pointer;width:100%;transition:.2s;text-transform:uppercase;
}
.secondary{
  background:transparent;color:#fff;border:2px solid var(--border);padding:14px;border-radius:16px;
  font-weight:900;font-size:.95rem;cursor:pointer;width:100%;transition:.2s;text-transform:uppercase;
}
.toast{
  position:fixed;bottom:calc(24px + var(--safe-bottom));left:50%;transform:translateX(-50%);
  background:#111;border:1px solid #333;padding:12px 18px;border-radius:999px;
  font-size:.85rem;opacity:0;transition:opacity .2s;z-index:1000;
}
.toast.show{opacity:1}
.footer{text-align:center;margin-top:30px;padding-top:20px;border-top:1px solid var(--border);color:#666;font-size:.85rem}
.footer a{color:#888;margin:0 10px;text-decoration:none}

@media (max-width:600px){ .two-col-grid{grid-template-columns:1fr} }
</style>
</head>

<body>
<div id="app"></div>
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  "use strict";

  // ======================
  // CONFIGURATION
  // ======================
  const RAZORPAY_KEY = "rzp_test_YOUR_KEY_ID"; // <--- REPLACE THIS WITH YOUR KEY
  const SUPABASE_URL = "https://zdarsygrpqbbcafrqcjt.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkYXJzeWdycHFiYmNhZnJxY2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODczMTUsImV4cCI6MjA4NjU2MzMxNX0.ut97BRi9_UFkeZuG_6Ue4mXdAAmtH6MFFdi2vUgHiW4";

  let sbClient = null;

  function initSupabase(){
    try{
      if(window.supabase && window.supabase.createClient){
        sbClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      }
    }catch(e){ console.error(e); }
  }

  // ======================
  // STATE & DATA
  // ======================
  var STATE = {
    cart: [],
    orders: [],
    session: "SID-" + Math.random().toString(36).slice(2,6).toUpperCase(),
    selectedRestaurantId: null,
    filterCategory: 'all',
    selectedPaymentMethod: null
  };

  // Rich Food Data (Integrated)
  var FOOD_DATA = {
    restaurants: [
      {
        id: "rajkot-thali-001",
        name: "Unlimited Gujarati Thali",
        brand: "Family Restaurant",
        city: "Rajkot",
        area: "Race Course Road",
        rating: 4.8,
        prepTime: 25,
        priceHint: 150,
        icon: "üçõ",
        upiId: "6351537770@yapl", 
        whatsapp: "https://wa.me/916351537770",
        hours: "11:00 AM - 10:30 PM",
        tags: ["veg", "family", "unlimited"],
        menu: [
          {id:"thali-1",name:"Gujarati Thali",price:150,veg:true,desc:"Unlimited traditional thali",prepMins:20,category:"main",icon:"üçõ"},
          {id:"pav-1",name:"Pav Bhaji",price:120,veg:true,desc:"Mumbai style pav bhaji",prepMins:15,category:"main",icon:"ü•ò"},
          {id:"dhokla-1",name:"Khaman Dhokla",price:60,veg:true,desc:"Soft and fluffy steamed dhokla",prepMins:10,category:"snacks",icon:"üü°"},
          {id:"chaas-1",name:"Masala Chaas",price:25,veg:true,desc:"Fresh buttermilk",prepMins:5,category:"drinks",icon:"ü•§"}
        ]
      }
    ]
  };

  // E-commerce Data
  var ECOMMERCE_DATA = [
    {category:"smartphones",name:"iPhone 15 Pro",price:134900,seller:"Apple Store",city:"Gandhidham"},
    {category:"earbuds",name:"AirPods Pro 2",price:24499,seller:"Apple Store",city:"Gandhidham"}
  ];

  // Helpers
  function $(id){ return document.getElementById(id); }
  function esc(s){ return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;"); }
  function money(n){ return "‚Çπ" + Number(n||0).toLocaleString("en-IN"); }
  function toast(msg){
    var t = $("toast"); t.textContent = msg; t.classList.add("show");
    setTimeout(function(){ t.classList.remove("show"); }, 2500);
  }

  // ======================
  // MAIN VIEWS
  // ======================
  function renderLobby(){
    $("app").innerHTML = `
      <div class="header">
        <div class="header-badge">DECIDE INDIA <span class="status-dot"></span></div>
        <button class="btn" data-action="home">HOME</button>
      </div>
      <div class="two-col-grid">
        <div class="left-col">
          <div class="col-header">MODULES</div>
          <div class="card" role="button" data-action="module" data-module="food">
            <div class="icon">üçΩÔ∏è</div><div class="title">FOOD</div><div class="tag tag-live">RAJKOT LIVE</div>
          </div>
          <div class="card" role="button" data-action="module" data-module="ecommerce">
            <div class="icon">üõçÔ∏è</div><div class="title">E-COMMERCE</div><div class="tag tag-live">GANDHIDHAM</div>
          </div>
        </div>
        <div class="right-col">
          <div class="col-header">ACCOUNT</div>
          <div class="card" role="button" data-action="cart">
            <div class="icon">üõí</div><div class="title">CART</div>
            <div class="tag tag-neutral">${STATE.cart.length} ITEMS</div>
          </div>
          <div class="card" role="button" data-action="orders">
            <div class="icon">üì¶</div><div class="title">ORDERS</div>
          </div>
        </div>
      </div>
      <div class="footer">Decide Marketplace</div>
    `;
  }

  // ======================
  // FOOD MODULE
  // ======================
  function renderFood(){
    var html = FOOD_DATA.restaurants.map(function(r){
      return `
        <div class="restaurant-card" role="button" data-action="restaurant" data-rid="${r.id}">
          <div class="restaurant-image">${r.icon}</div>
          <div class="restaurant-info">
            <div class="restaurant-name">${esc(r.name)}</div>
            <div class="restaurant-meta">‚≠ê ${r.rating} ‚Ä¢ ${r.prepTime} mins ‚Ä¢ ${esc(r.area)}</div>
            <div class="restaurant-tags">
              ${r.tags.map(t => `<span class="food-tag">${t}</span>`).join('')}
            </div>
          </div>
        </div>
      `;
    }).join("");

    $("app").innerHTML = `
      <div class="wrap">
        <div class="h1">ORDER FOOD</div>
        <div class="p">Rajkot ‚Ä¢ Zero Commission</div>
        ${html}
        <button class="secondary" data-action="home" style="margin-top:20px">‚Üê HOME</button>
      </div>
    `;
  }

  function renderRestaurant(rid){
    var r = FOOD_DATA.restaurants.find(function(x){ return x.id === rid; });
    if(!r) return renderFood();
    STATE.selectedRestaurantId = r.id;

    // Filter Items
    var items = (r.menu || []).filter(function(it){
      return STATE.filterCategory === 'all' || it.category === STATE.filterCategory;
    });

    var categories = ['all', ...new Set(r.menu.map(i => i.category))];
    var catBtns = categories.map(c => 
      `<button class="category-btn ${STATE.filterCategory === c ? 'active':''}" data-action="filterFood" data-cat="${c}">${c.toUpperCase()}</button>`
    ).join("");

    var menuHtml = items.map(function(it){
      return `
        <div class="menu-item">
          <div class="menu-item-header">
            <div>
              <div class="menu-item-name">${esc(it.name)}</div>
              <div style="font-size:0.8rem;color:#888">${esc(it.desc)}</div>
            </div>
            <div style="font-size:2rem">${it.icon}</div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
            <div class="menu-item-price">${money(it.price)}</div>
            <button class="add-btn" data-action="addFood" data-id="${it.id}">ADD +</button>
          </div>
        </div>
      `;
    }).join("");

    $("app").innerHTML = `
      <div class="wrap">
        <div class="h1">${esc(r.name)}</div>
        <div class="p">${esc(r.brand)} ‚Ä¢ ${esc(r.area)}</div>
        <div class="menu-categories">${catBtns}</div>
        ${menuHtml}
        <button class="action" data-action="cart">VIEW CART (${STATE.cart.length})</button>
        <button class="secondary" data-action="food" style="margin-top:10px">‚Üê BACK</button>
      </div>
    `;
  }

  function addFoodItem(itemId){
    var r = FOOD_DATA.restaurants.find(x => x.id === STATE.selectedRestaurantId);
    var item = r.menu.find(i => i.id === itemId);
    if(item){
      STATE.cart.push({
        type: 'food',
        id: item.id,
        name: item.name,
        price: item.price,
        restaurantId: r.id,
        upiId: r.upiId,
        whatsapp: r.whatsapp
      });
      toast("Added " + item.name);
      // Re-render to update cart count if needed, or just stay
    }
  }

  // ======================
  // CART & CHECKOUT
  // ======================
  function renderCart(){
    if(!STATE.cart.length){
      $("app").innerHTML = `<div class="wrap" style="text-align:center"><div class="h1">CART EMPTY</div><button class="secondary" data-action="home">‚Üê HOME</button></div>`;
      return;
    }

    var total = STATE.cart.reduce((s,i) => s + i.price, 0);
    var isFood = STATE.cart[0].type === 'food';

    var itemsHtml = STATE.cart.map((it, idx) => `
      <div style="display:flex;justify-content:space-between;padding:12px;border-bottom:1px solid var(--border)">
        <div>${esc(it.name)}</div>
        <div style="display:flex;gap:10px">
          <b>${money(it.price)}</b>
          <button style="color:#ff4444" data-action="remove" data-idx="${idx}">‚úï</button>
        </div>
      </div>
    `).join("");

    $("app").innerHTML = `
      <div class="wrap">
        <div class="h1">YOUR CART</div>
        <div class="payment-box">
          ${itemsHtml}
          <div style="display:flex;justify-content:space-between;padding-top:15px;font-size:1.2rem;font-weight:900;color:var(--brand-orange)">
            <span>Total</span>
            <span>${money(total)}</span>
          </div>
        </div>
        <button class="action" data-action="pay">PROCEED TO PAY</button>
        <button class="secondary" data-action="home" style="margin-top:10px">‚Üê ADD MORE</button>
      </div>
    `;
  }

  function renderPayment(){
    var total = STATE.cart.reduce((s,i) => s + i.price, 0);
    var isFood = STATE.cart.some(i => i.type === 'food');

    var options = '';
    if(isFood){
      options += `
        <div class="payment-option ${STATE.selectedPaymentMethod==='razorpay'?'selected':''}" role="button" data-action="selectMethod" data-method="razorpay">
          <div style="font-size:1.5rem">üí≥</div>
          <div><div style="font-weight:900">Razorpay</div><div style="font-size:0.8rem;color:#888">Cards, UPI, Netbanking</div></div>
        </div>
        <div class="payment-option ${STATE.selectedPaymentMethod==='manual_upi'?'selected':''}" role="button" data-action="selectMethod" data-method="manual_upi">
          <div style="font-size:1.5rem">üì≤</div>
          <div><div style="font-weight:900">Direct UPI</div><div style="font-size:0.8rem;color:#888">No Gateway Fee</div></div>
        </div>
      `;
    } else {
      options += `<div class="payment-option selected"><div style="font-weight:900">Cash on Delivery (Demo)</div></div>`;
    }

    $("app").innerHTML = `
      <div class="wrap">
        <div class="h1">PAYMENT</div>
        <div class="p">Amount to Pay: <span style="color:var(--brand-orange);font-weight:900">${money(total)}</span></div>
        <div class="payment-box">${options}</div>
        <button class="action" data-action="placeOrder">PAY & PLACE ORDER</button>
        <button class="secondary" data-action="cart" style="margin-top:10px">‚Üê BACK</button>
      </div>
    `;
  }

  // ======================
  // LOGIC
  // ======================
  function placeOrder(){
    var total = STATE.cart.reduce((s,i) => s + i.price, 0);
    var isFood = STATE.cart.some(i => i.type === 'food');

    if(isFood){
      if(STATE.selectedPaymentMethod === 'razorpay'){
        initiateRazorpay(total);
      } else if(STATE.selectedPaymentMethod === 'manual_upi'){
        // Show Manual UPI UI (Simplified for brevity)
        var r = FOOD_DATA.restaurants.find(x => x.id === STATE.cart[0].restaurantId);
        window.location.href = `upi://pay?pa=${r.upiId}&pn=Decide&am=${total}&cu=INR`;
        toast("Opening UPI App...");
        setTimeout(() => completeOrder("MANUAL-UPI", "Direct UPI", total), 3000);
      } else {
        toast("Please select a payment method");
      }
    } else {
      completeOrder("COD", "Cash", total);
    }
  }

  function initiateRazorpay(amount){
    if(typeof Razorpay === 'undefined') return toast("Razorpay not loaded");
    
    var options = {
      key: RAZORPAY_KEY,
      amount: amount * 100,
      currency: "INR",
      name: "Decide Marketplace",
      description: "Food Order",
      image: "https://via.placeholder.com/150",
      handler: function (response){
        completeOrder(response.razorpay_payment_id, "Razorpay", amount);
      },
      prefill: { name: "User", email: "user@decide.com", contact: "9999999999" },
      theme: { color: "#ff671f" }
    };
    var rzp1 = new Razorpay(options);
    rzp1.open();
  }

  function completeOrder(paymentId, method, amount){
    var orderId = "ORD-" + Date.now().toString().slice(-6);
    STATE.orders.push({
      id: orderId,
      items: [...STATE.cart],
      total: amount,
      paymentId: paymentId,
      method: method,
      status: 'Paid',
      date: new Date().toLocaleString()
    });
    
    // WhatsApp Notify
    var isFood = STATE.cart.some(i => i.type === 'food');
    if(isFood){
      var r = FOOD_DATA.restaurants.find(x => x.id === STATE.cart[0].restaurantId);
      if(r && r.whatsapp){
        var msg = `New Order ${orderId}%0AItems: ${STATE.cart.length}%0ATotal: ${amount}%0APaid via ${method}`;
        window.open(`${r.whatsapp}?text=${msg}`, '_blank');
      }
    }

    STATE.cart = [];
    $("app").innerHTML = `
      <div class="wrap" style="text-align:center;padding-top:50px">
        <div style="font-size:4rem">üéâ</div>
        <div class="h1" style="color:var(--accent)">ORDER SUCCESS</div>
        <div class="p">ID: ${orderId}</div>
        <button class="action" data-action="home">CONTINUE SHOPPING</button>
      </div>
    `;
  }

  // ======================
  // EVENT HANDLER
  // ======================
  document.addEventListener("click", function(e){
    var el = e.target.closest("[data-action]");
    if(!el) return;
    var action = el.dataset.action;

    if(action === "home") renderLobby();
    if(action === "module"){
      if(el.dataset.module === "food") renderFood();
      else toast("Coming Soon"); // Generic e-com placeholder
    }
    if(action === "restaurant") renderRestaurant(el.dataset.rid);
    if(action === "filterFood"){
      STATE.filterCategory = el.dataset.cat;
      renderRestaurant(STATE.selectedRestaurantId);
    }
    if(action === "addFood") addFoodItem(el.dataset.id);
    if(action === "cart") renderCart();
    if(action === "remove"){
      STATE.cart.splice(el.dataset.idx, 1);
      renderCart();
    }
    if(action === "pay") renderPayment();
    if(action === "selectMethod"){
      STATE.selectedPaymentMethod = el.dataset.method;
      renderPayment();
    }
    if(action === "placeOrder") placeOrder();
    if(action === "orders"){
      var html = STATE.orders.map(o => 
        `<div class="card" style="align-items:flex-start;margin-bottom:10px">
           <div style="font-weight:900">${o.id}</div>
           <div>${o.items.length} Items ‚Ä¢ ${money(o.total)}</div>
           <div class="tag tag-live">${o.status}</div>
         </div>`
      ).join("");
      $("app").innerHTML = `<div class="wrap"><div class="h1">MY ORDERS</div>${html||'<div class="p">No orders yet</div>'}<button class="secondary" data-action="home">‚Üê HOME</button></div>`;
    }
  });

  // Init
  initSupabase();
  renderLobby();

})();
</script>
</body>
</html>
